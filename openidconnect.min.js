var OIDC=namespace("OIDC");function JSONObjToHTMLTable(JSONObj){try{var HTMLString='\n<table class="table table-striped">';for(var claim in JSONObj)HTMLString=HTMLString+"\n<TR><TD>"+claim+"</TD><TD>"+JSONObj[claim]+"</TD></TR>";return HTMLString+="\n</table>"}catch(e){throw new OidcException("Unable to get JSON Obj to HTML table:"+e.toString())}}function OidcException(message){this.name="OidcException",this.message=message}function namespace(namespaceString){for(var parts=namespaceString.split("."),parent=window,currentPart="",i=0,length=parts.length;i<length;i++)parent[currentPart=parts[i]]=parent[currentPart]||{},parent=parent[currentPart];return parent}OIDC.supportedProviderOptions=["issuer","authorization_endpoint","jwks_uri","claims_parameter_supported","request_parameter_supported","jwks"],OIDC.supportedRequestOptions=["scope","response_type","display","max_age","claims","request"],OIDC.supportedClientOptions=["client_id","redirect_uri"],OIDC.supportedValidationOptions=["validator"],OIDC.setProviderInfo=function(p){var params=this.supportedProviderOptions;try{if("undefined"!==p)for(var i=0;i<params.length;i++)"undefined"!==p[params[i]]&&(this[params[i]]=p[params[i]]);return!0}catch(e){throw new OidcException("Unable to set the Identity Provider's configuration parameters: "+e.toString())}},OIDC.setClientInfo=function(p){var params=this.supportedClientOptions;try{if(void 0!==p){void 0===p.client_id&&(clientInfoFromServer=OIDC.registerClient(p.redirect_uri),p.client_id=clientInfoFromServer.client_id);for(var i=0;i<params.length;i++)void 0!==p[params[i]]&&(this[params[i]]=p[params[i]])}return!0}catch(e){throw new OidcException("Unable to set the Client's configuration parameters: "+e.toString())}},OIDC.debug=function(toggle,id_token){if(1==toggle){var providerInfo=sessionStorage.providerInfo,clientInfo=sessionStorage.clientInfo,sigVerified=this.verifyIdTokenSig(id_token),valid=this.isValidIdToken(id_token);console.log({provider:providerInfo,client:clientInfo}),valid||console.log("Id_token is not valid!"),sigVerified||console.log("The signature of the id_token is not verified!"),sigVerified&&valid&&console.log("Id_token is valid and its signature is verified!")}},OIDC.storeInfo=function(providerInfo,clientInfo){var pOptions=this.supportedProviderOptions,cOptions=this.supportedClientOptions,pInfo={},cInfo={};try{if(providerInfo){for(var i=0;i<pOptions.length;i++)void 0!==providerInfo[pOptions[i]]&&(pInfo[pOptions[i]]=providerInfo[pOptions[i]]);sessionStorage.providerInfo=JSON.stringify(pInfo)}else sessionStorage.providerInfo&&sessionStorage.removeItem("providerInfo");if(clientInfo){for(i=0;i<cOptions.length;i++)void 0!==clientInfo[cOptions[i]]&&(cInfo[cOptions[i]]=clientInfo[cOptions[i]]);sessionStorage.clientInfo=JSON.stringify(cInfo)}else sessionStorage.clientInfo&&sessionStorage.removeItem("clientInfo")}catch(e){throw new OidcException("Unable to store the Identity Provider and Client configuration options: "+e.toString())}},OIDC.restoreInfo=function(){var providerInfo=sessionStorage.providerInfo,clientInfo=sessionStorage.clientInfo;try{providerInfo&&this.setProviderInfo(JSON.parse(providerInfo)),clientInfo&&this.setClientInfo(JSON.parse(clientInfo))}catch(e){throw new OidcException("Unable to restore the Identity Provider and Client configuration options: "+e.toString())}},OIDC.checkRequiredInfo=function(params){try{if(params)for(var i=0;i<params.length;i++)if(!this[params[i]])throw new OidcException("Required parameter not set - "+params[i]);return!0}catch(e){throw new OidcException("Unable to check whether the required configuration parameters are set: "+e.toString())}},OIDC.clearProviderInfo=function(){try{for(var i=0;i<this.supportedProviderOptions.length;i++)this[this.supportedProviderOptions[i]]=null}catch(e){throw new OidcException("Unable to clear the Identity Provider configuration parameters: "+e.toString())}},OIDC.generateLoginRequest=function(reqOptions){try{this.checkRequiredInfo(new Array("client_id","redirect_uri","authorization_endpoint"));var state=null,nonce=null,crypto=window.crypto||window.msCrypto;if(crypto&&crypto.getRandomValues){var D=new Uint32Array(2);crypto.getRandomValues(D),state=D[0].toString(36),nonce=D[1].toString(36)}else{var byteArrayToLong=function(byteArray){for(var value=0,i=byteArray.length-1;0<=i;i--)value=256*value+byteArray[i];return value};rng_seed_time();var sRandom=new SecureRandom,randState=new Array(4);sRandom.nextBytes(randState),state=byteArrayToLong(randState).toString(36),rng_seed_time();var randNonce=new Array(4);sRandom.nextBytes(randNonce),nonce=byteArrayToLong(randNonce).toString(36)}sessionStorage.state=state,sessionStorage.nonce=nonce;var response_type="id_token",scope="openid",display=null,max_age=null,claims=null,idTokenClaims={},userInfoClaims={};if(reqOptions){if(reqOptions.response_type){var parts=reqOptions.response_type.split(" "),temp=[];if(parts)for(var i=0;i<parts.length;i++)"code"!=parts[i]&&"token"!=parts[i]&&"id_token"!=parts[i]||temp.push(parts[i]);temp&&(response_type=temp.join(" "))}if(reqOptions.scope&&(scope=reqOptions.scope),reqOptions.display&&(display=reqOptions.display),reqOptions.max_age&&(max_age=reqOptions.max_age),reqOptions.claims){if(!this.claims_parameter_supported)throw new OidcException("Provider does not support claims request parameter");if(reqOptions.claims.id_token){for(var j=0;j<reqOptions.claims.id_token.length;j++)idTokenClaims[reqOptions.claims.id_token[j]]=null;claims||(claims={}),claims.id_token=idTokenClaims}if(reqOptions.claims.userinfo){for(var k=0;k<reqOptions.claims.userinfo.length;k++)userInfoClaims[reqOptions.claims.userinfo[k]]=null;claims||(claims={}),claims.userinfo=userInfoClaims}}}var optParams="";display&&(optParams+="&display="+display),max_age&&(optParams+="&max_age="+max_age),claims&&(optParams+="&claims="+JSON.stringify(claims));var url=this.authorization_endpoint+"?response_type="+response_type+"&scope="+scope+"&nonce="+nonce+"&client_id="+this.client_id+"&redirect_uri="+this.redirect_uri+"&state="+state+optParams;return{authorization_endpoint:this.authorization_endpoint,response_type:response_type,scope:scope,nonce:nonce,client_id:this.client_id,redirect_uri:this.redirect_uri,state:state,optional_parameters:optParams,url:url}}catch(e){throw new OidcException("Unable to generate login request: "+e.toString())}},OIDC.login=function(reqOptions){try{this.checkRequiredInfo(new Array("client_id","redirect_uri","authorization_endpoint"));var reqOptionsExist=!!reqOptions,state=null,nonce=null;reqOptionsExist&&reqOptions.nonce&&reqOptions.state&&(state=reqOptions.state,nonce=reqOptions.nonce);var crypto=window.crypto||window.msCrypto;if(crypto&&crypto.getRandomValues){var D=new Uint32Array(2);crypto.getRandomValues(D),state=reqOptionsExist&&reqOptions.state?reqOptions.state:D[0].toString(36),nonce=reqOptionsExist&&reqOptions.nonce?reqOptions.nonce:D[1].toString(36)}else{var byteArrayToLong=function(byteArray){for(var value=0,i=byteArray.length-1;0<=i;i--)value=256*value+byteArray[i];return value};rng_seed_time();var sRandom=new SecureRandom,randState=new Array(4);sRandom.nextBytes(randState),state=byteArrayToLong(randState).toString(36),rng_seed_time();var randNonce=new Array(4);sRandom.nextBytes(randNonce),nonce=byteArrayToLong(randNonce).toString(36)}sessionStorage.state=state,sessionStorage.nonce=nonce;var response_type="id_token",scope="openid",display=null,max_age=null,claims=null,idTokenClaims={},userInfoClaims={};if(reqOptionsExist){if(reqOptions.response_type){var parts=reqOptions.response_type.split(" "),temp=[];if(parts)for(var i=0;i<parts.length;i++)"code"!=parts[i]&&"token"!=parts[i]&&"id_token"!=parts[i]||temp.push(parts[i]);temp&&(response_type=temp.join(" "))}if(reqOptions.scope&&(scope=reqOptions.scope),reqOptions.display&&(display=reqOptions.display),reqOptions.max_age&&(max_age=reqOptions.max_age),reqOptions.claims){if(!this.claims_parameter_supported)throw new OidcException("Provider does not support claims request parameter");if(reqOptions.claims.id_token){for(var j=0;j<reqOptions.claims.id_token.length;j++)idTokenClaims[reqOptions.claims.id_token[j]]=null;claims||(claims={}),claims.id_token=idTokenClaims}if(reqOptions.claims.userinfo){for(var k=0;k<reqOptions.claims.userinfo.length;k++)userInfoClaims[reqOptions.claims.userinfo[k]]=null;claims||(claims={}),claims.userinfo=userInfoClaims}}}var optParams="";display&&(optParams+="&display="+display),max_age&&(optParams+="&max_age="+max_age),claims&&(optParams+="&claims="+JSON.stringify(claims));var url=this.authorization_endpoint+"?response_type="+response_type+"&scope="+scope+"&nonce="+nonce+"&client_id="+this.client_id+"&redirect_uri="+this.redirect_uri+"&state="+state+optParams;if(reqOptions.window)return window.open(url,"_blank",reqOptions.window);window.location.replace(url)}catch(e){throw new OidcException("Unable to redirect to the Identity Provider for authenticaton: "+e.toString())}},OIDC.verifyIdTokenSig=function(id_token){try{var verified=!1;if(!(this.jwks_uri||this.jwks))throw new OidcException("jwks_uri or jwks parameter not set");if(id_token){var idtParts=this.getIdTokenParts(id_token),header=this.getJsonObject(idtParts[0]),jwks=this.jwks||this.fetchJSON(this.jwks_uri);if(!jwks)throw new OidcException("No JWK keyset");if(!header.alg||"RS"!=header.alg.substr(0,2))throw new OidcException("Unsupported JWS signature algorithm "+header.alg);var jwk=this.jwk_get_key(jwks,"RSA","sig",header.kid);jwk?verified=this.rsaVerifyJWS(id_token,jwk[0]):new OidcException("No matching JWK found")}return verified}catch(e){throw new OidcException("Unable to verify the ID Token signature: "+e.toString())}},OIDC.isValidIdToken=function(id_token){try{var valid=!1;if(this.checkRequiredInfo(["issuer","client_id"]),id_token){var idtParts=this.getIdTokenParts(id_token),payload=this.getJsonObject(idtParts[1]);if(!payload)throw new OidcException("Unable to parse JWS payload");var now=new Date/1e3;if(payload.iat>now+300)throw new OidcException("ID Token issued time is later than current time");if(payload.exp<now-300)throw new OidcException("ID Token expired");var audience=null;if(payload.aud&&(audience=payload.aud instanceof Array?payload.aud[0]:payload.aud),audience!=this.client_id)throw new OidcException("invalid audience");if(payload.iss!=this.issuer)throw new OidcException("invalid issuer "+payload.iss+" != "+this.issuer);if(payload.nonce!=sessionStorage.nonce)throw new OidcException("invalid nonce");valid=!0}return valid}catch(e){throw new OidcException("Unable to validate information in the ID Token: "+e.toString())}},OIDC.rsaVerifyJWS=function(jws,jwk){try{if(jws&&"object"==typeof jwk){if("RSA"!=jwk.kty)throw new OidcException("No RSA kty in JWK");var verifier=KJUR.jws.JWS;if(jwk.n&&jwk.e){var pubkey=KEYUTIL.getKey({kty:"RSA",n:jwk.n,e:jwk.e});return verifier.verify(jws,pubkey,["RS256"])}if(jwk.x5c)return verifier.verifyJWSByPemX509Cert(jws,"-----BEGIN CERTIFICATE-----\n"+jwk.x5c[0]+"\n-----END CERTIFICATE-----\n")}}catch(e){throw new OidcException("Unable to verify the JWS string: "+e.toString())}},OIDC.getValidIdToken=function(validationOptions){try{var url=window.location.href,error=url.match("[?&]error=([^&]*)");if(error){var description=url.match("[?&]error_description=([^&]*)");throw new OidcException(error[1]+" Description: "+description[1])}var customValidatorExists=validationOptions&&validationOptions.validator&&"function"==typeof validationOptions.validator,urlState=OIDC.getState(),storedState=sessionStorage.state,goodState=customValidatorExists?validationOptions.validator(urlState,storedState):urlState===storedState,match=url.match("[?#&]id_token=([^&]*)");if(!goodState)throw new OidcException("State mismatch");if(!match)throw new OidcException("No ID Token returned");var id_token=match[1];if(!id_token)throw new OidcException("Could not retrieve ID Token from the URL");var sigVerified=this.verifyIdTokenSig(id_token),valid=this.isValidIdToken(id_token);if(sigVerified&&valid)return id_token}catch(e){throw new OidcException("Unable to get the ID Token from the current page URL: "+e.toString())}},OIDC.getState=function(){try{var smatch=window.location.href.match("[?&]state=([^&]*)");return smatch&&smatch[1]?decodeURIComponent(smatch[1]):(console.error(new Error("No State parameter found on current page URL!")),null)}catch(e){throw new OidcException("Unable to get the State from the current page URL: "+e.toString())}},OIDC.getAccessToken=function(){try{var token=window.location.href.match("[?#&]access_token=([^&]*)");return token?token[1]:(console.error(new Error("No access_token found on current page URL!")),null)}catch(e){throw new OidcException("Unable to get the Access Token from the current page URL: "+e.toString())}},OIDC.getCode=function(){try{var code=window.location.href.match("[?&]code=([^(&)]*)");if(code)return code[1]}catch(e){throw new OidcException("Unable to get the Authorization Code from the current page URL: "+e.toString())}},OIDC.getIdTokenParts=function(id_token){try{var jws=new KJUR.jws.JWS;return jws.parseJWS(id_token),new Array(jws.parsedJWS.headS,jws.parsedJWS.payloadS,jws.parsedJWS.si)}catch(e){throw new OidcException("Unable to split the ID Token string: "+e.toString())}},OIDC.getIdTokenPayload=function(id_token){try{var parts=this.getIdTokenParts(id_token);if(parts)return this.getJsonObject(parts[1])}catch(e){throw new OidcException("Unable to get the contents of the ID Token payload: "+e.toString())}},OIDC.getJsonObject=function(jsonS){try{var jws=KJUR.jws.JWS;if(jws.isSafeJSONString(jsonS))return jws.readSafeJSONString(jsonS)}catch(e){throw new OidcException("Unable to get the JSON object from JSON string: "+e.toString())}},OIDC.fetchJSON=function(url){try{var request=new XMLHttpRequest;if(request.open("GET",url,!1),request.send(null),200===request.status)return request.responseText;throw new OidcException("fetchJSON - "+request.status+" "+request.statusText)}catch(e){throw new OidcException("Unable to retrieve JSON file at "+url+" : "+e.toString())}return null},OIDC.jwk_get_key=function(jwkIn,kty,use,kid){try{var jwk=null,foundKeys=[];if(jwkIn&&("string"==typeof jwkIn?jwk=this.getJsonObject(jwkIn):"object"==typeof jwkIn&&(jwk=jwkIn),null!=jwk&&"object"==typeof jwk.keys)){if(0==jwk.keys.length)return null;for(var i=0;i<jwk.keys.length;i++)jwk.keys[i].kty==kty&&foundKeys.push(jwk.keys[i]);if(0==foundKeys.length)return null;if(use){for(var temp=[],j=0;j<foundKeys.length;j++)foundKeys[j].use?foundKeys[j].use==use&&temp.push(foundKeys[j]):temp.push(foundKeys[j]);foundKeys=temp}if(0==foundKeys.length)return null;if(kid){temp=[];for(var k=0;k<foundKeys.length;k++)foundKeys[k].kid==kid&&temp.push(foundKeys[k]);foundKeys=temp}return 0==foundKeys.length?null:foundKeys}}catch(e){throw new OidcException("Unable to retrieve the JWK key: "+e.toString())}},OIDC.discover=function(issuer){try{var discovery=null;if(issuer){var openidConfig=issuer+"/.well-known/openid-configuration",discoveryDoc=this.fetchJSON(openidConfig);discoveryDoc&&(discovery=this.getJsonObject(discoveryDoc))}return discovery}catch(e){throw new OidcException("Unable to perform discovery: "+e.toString())}},OIDC.getUserInfo=function(access_token){try{var providerURL=JSON.parse(sessionStorage.providerInfo).issuer,providerInfo=OIDC.discover(providerURL),request=new XMLHttpRequest;if(request.open("POST",providerInfo.userinfo_endpoint,!1),request.setRequestHeader("Content-type","application/x-www-form-urlencoded"),request.setRequestHeader("authorization","Bearer "+access_token),request.send(null),200===request.status)return request.responseText;throw new OidcException("getUserInfo - "+request.status+" "+request.statusText)}catch(e){throw new OidcException("Unable to get user info:"+e.toString())}},OIDC.registerClient=function(redirect_uri){try{var clientMetadata={redirect_uris:[redirect_uri],application_type:"Web",client_name:"Dynamically Registered Client",subject_type:"public",grant_types:["implicit"],response_types:["token","id_token"],scopes:["email","openid","profile"]},request=new XMLHttpRequest;if(request.open("POST",providerInfo.registration_endpoint,!1),request.setRequestHeader("Content-Type","application/json"),request.setRequestHeader("Accept","application/json"),request.send(JSON.stringify(clientMetadata)),200===request.status)return JSON.parse(request.responseText);throw new OidcException("getUserInfo - "+request.status+" "+request.statusText)}catch(e){throw new OidcException("Unable to register new client:"+e.toString())}},OidcException.prototype=new Error,OidcException.prototype.constructor=OidcException;var CryptoJS=CryptoJS||function(a,b){var c=Object.create||function(){function a(){}return function(b){var c;return a.prototype=b,c=new a,a.prototype=null,c}}(),d={},e=d.lib={},f=e.Base={extend:function(a){var b=c(this);return a&&b.mixIn(a),b.hasOwnProperty("init")&&this.init!==b.init||(b.init=function(){b.$super.init.apply(this,arguments)}),(b.init.prototype=b).$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=e.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=null!=c?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes,e=a.sigBytes;if(this.clamp(),d%4)for(var f=0;f<e;f++){var g=c[f>>>2]>>>24-f%4*8&255;b[d+f>>>2]|=g<<24-(d+f)%4*8}else for(f=0;f<e;f+=4)b[d+f>>>2]=c[f>>>2];return this.sigBytes+=e,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-c%4*8,b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var f,c=[],d=function(b){b=b;var c=987654321,d=4294967295;return function(){var e=((c=36969*(65535&c)+(c>>16)&d)<<16)+(b=18e3*(65535&b)+(b>>16)&d)&d;return e/=4294967296,(e+=.5)*(.5<a.random()?1:-1)}},e=0;e<b;e+=4){var h=d(4294967296*(f||a.random()));f=987654071*h(),c.push(4294967296*h()|0)}return new g.init(c,b)}}),h=d.enc={},i=h.Hex={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push((f>>>4).toString(16)),d.push((15&f).toString(16))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-d%8*4;return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){for(var b=a.words,c=a.sigBytes,d=[],e=0;e<c;e++){var f=b[e>>>2]>>>24-e%4*8&255;d.push(String.fromCharCode(f))}return d.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-d%4*8;return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(a){throw new Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=e.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,i=e/(4*f),j=(i=b?a.ceil(i):a.max((0|i)-this._minBufferSize,0))*f,k=a.min(4*j,e);if(j){for(var l=0;l<j;l+=f)this._doProcessBlock(d,l);var m=d.splice(0,j);c.sigBytes-=k}return new g.init(m,k)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0}),n=(e.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new n.HMAC.init(a,c).finalize(b)}}}),d.algo={});return d}(Math);!function(){var k=CryptoJS,m=(b=k.lib).WordArray,l=b.Hasher,d=[],b=k.algo.SHA1=l.extend({_doReset:function(){this._hash=new m.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(n,p){for(var a=this._hash.words,e=a[0],f=a[1],h=a[2],j=a[3],b=a[4],c=0;c<80;c++){if(c<16)d[c]=0|n[p+c];else{var g=d[c-3]^d[c-8]^d[c-14]^d[c-16];d[c]=g<<1|g>>>31}g=(e<<5|e>>>27)+b+d[c],g=c<20?g+(1518500249+(f&h|~f&j)):c<40?g+(1859775393+(f^h^j)):c<60?g+((f&h|f&j|h&j)-1894007588):g+((f^h^j)-899497514),b=j,j=h,h=f<<30|f>>>2,f=e,e=g}a[0]=a[0]+e|0,a[1]=a[1]+f|0,a[2]=a[2]+h|0,a[3]=a[3]+j|0,a[4]=a[4]+b|0},_doFinalize:function(){var b=this._data,d=b.words,a=8*this._nDataBytes,e=8*b.sigBytes;return d[e>>>5]|=128<<24-e%32,d[14+(e+64>>>9<<4)]=Math.floor(a/4294967296),d[15+(e+64>>>9<<4)]=a,b.sigBytes=4*d.length,this._process(),this._hash},clone:function(){var b=l.clone.call(this);return b._hash=this._hash.clone(),b}});k.SHA1=l._createHelper(b),k.HmacSHA1=l._createHmacHelper(b)}(),function(k){for(var g=CryptoJS,v=(h=g.lib).WordArray,j=h.Hasher,h=g.algo,s=[],t=[],u=function(q){return 4294967296*(q-(0|q))|0},l=2,b=0;b<64;){var d;a:{d=l;for(var w=k.sqrt(d),r=2;r<=w;r++)if(!(d%r)){d=!1;break a}d=!0}d&&(b<8&&(s[b]=u(k.pow(l,.5))),t[b]=u(k.pow(l,1/3)),b++),l++}var n=[];h=h.SHA256=j.extend({_doReset:function(){this._hash=new v.init(s.slice(0))},_doProcessBlock:function(q,h){for(var a=this._hash.words,c=a[0],d=a[1],b=a[2],k=a[3],f=a[4],g=a[5],j=a[6],l=a[7],e=0;e<64;e++){if(e<16)n[e]=0|q[h+e];else{var m=n[e-15],p=n[e-2];n[e]=((m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3)+n[e-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+n[e-16]}m=l+((f<<26|f>>>6)^(f<<21|f>>>11)^(f<<7|f>>>25))+(f&g^~f&j)+t[e]+n[e],p=((c<<30|c>>>2)^(c<<19|c>>>13)^(c<<10|c>>>22))+(c&d^c&b^d&b),l=j,j=g,g=f,f=k+m|0,k=b,b=d,d=c,c=m+p|0}a[0]=a[0]+c|0,a[1]=a[1]+d|0,a[2]=a[2]+b|0,a[3]=a[3]+k|0,a[4]=a[4]+f|0,a[5]=a[5]+g|0,a[6]=a[6]+j|0,a[7]=a[7]+l|0},_doFinalize:function(){var d=this._data,b=d.words,a=8*this._nDataBytes,c=8*d.sigBytes;return b[c>>>5]|=128<<24-c%32,b[14+(c+64>>>9<<4)]=k.floor(a/4294967296),b[15+(c+64>>>9<<4)]=a,d.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var b=j.clone.call(this);return b._hash=this._hash.clone(),b}});g.SHA256=j._createHelper(h),g.HmacSHA256=j._createHmacHelper(h)}(Math),function(g){var a,f=(a=CryptoJS).lib,e=f.Base,h=f.WordArray;(a=a.x64={}).Word=e.extend({init:function(b,c){this.high=b,this.low=c}}),a.WordArray=e.extend({init:function(b,c){b=this.words=b||[],this.sigBytes=null!=c?c:8*b.length},toX32:function(){for(var b=this.words,c=b.length,a=[],d=0;d<c;d++){var e=b[d];a.push(e.high),a.push(e.low)}return h.create(a,this.sigBytes)},clone:function(){for(var b=e.clone.call(this),c=b.words=this.words.slice(0),a=c.length,d=0;d<a;d++)c[d]=c[d].clone();return b}})}(),function(){function a(){return d.create.apply(d,arguments)}for(var n=CryptoJS,r=n.lib.Hasher,d=(e=n.x64).Word,T=e.WordArray,e=n.algo,ea=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],v=[],w=0;w<80;w++)v[w]=a();e=e.SHA512=r.extend({_doReset:function(){this._hash=new T.init([new d.init(1779033703,4089235720),new d.init(3144134277,2227873595),new d.init(1013904242,4271175723),new d.init(2773480762,1595750129),new d.init(1359893119,2917565137),new d.init(2600822924,725511199),new d.init(528734635,4215389547),new d.init(1541459225,327033209)])},_doProcessBlock:function(a,d){for(var F=(f=this._hash.words)[0],e=f[1],n=f[2],r=f[3],G=f[4],H=f[5],I=f[6],f=f[7],w=F.high,J=F.low,X=e.high,K=e.low,Y=n.high,L=n.low,Z=r.high,M=r.low,$=G.high,N=G.low,aa=H.high,O=H.low,ba=I.high,P=I.low,ca=f.high,Q=f.low,k=w,g=J,z=X,x=K,A=Y,y=L,U=Z,B=M,l=$,h=N,R=aa,C=O,S=ba,D=P,V=ca,E=Q,m=0;m<80;m++){var s=v[m];if(m<16)var j=s.high=0|a[d+2*m],b=s.low=0|a[d+2*m+1];else{j=((b=(j=v[m-15]).high)>>>1|(p=j.low)<<31)^(b>>>8|p<<24)^b>>>7;var p=(p>>>1|b<<31)^(p>>>8|b<<24)^(p>>>7|b<<25),u=((b=(u=v[m-2]).high)>>>19|(c=u.low)<<13)^(b<<3|c>>>29)^b>>>6,c=(c>>>19|b<<13)^(c<<3|b>>>29)^(c>>>6|b<<26),W=(b=v[m-7]).high,q=(t=v[m-16]).high,t=t.low;j=(j=(j=j+W+((b=p+b.low)>>>0<p>>>0?1:0))+u+((b=b+c)>>>0<c>>>0?1:0))+q+((b=b+t)>>>0<t>>>0?1:0);s.high=j,s.low=b}W=l&R^~l&S,t=h&C^~h&D,s=k&z^k&A^z&A;var T=g&x^g&y^x&y,fa=(p=(k>>>28|g<<4)^(k<<30|g>>>2)^(k<<25|g>>>7),u=(g>>>28|k<<4)^(g<<30|k>>>2)^(g<<25|k>>>7),(c=ea[m]).high),da=c.low;q=V+((l>>>14|h<<18)^(l>>>18|h<<14)^(l<<23|h>>>9))+((c=E+((h>>>14|l<<18)^(h>>>18|l<<14)^(h<<23|l>>>9)))>>>0<E>>>0?1:0),V=S,E=D,S=R,D=C,R=l,C=h,l=U+(q=(q=(q=q+W+((c=c+t)>>>0<t>>>0?1:0))+fa+((c=c+da)>>>0<da>>>0?1:0))+j+((c=c+b)>>>0<b>>>0?1:0))+((h=B+c|0)>>>0<B>>>0?1:0)|0,U=A,B=y,A=z,y=x,z=k,x=g,k=q+(s=p+s+((b=u+T)>>>0<u>>>0?1:0))+((g=c+b|0)>>>0<c>>>0?1:0)|0}J=F.low=J+g,F.high=w+k+(J>>>0<g>>>0?1:0),K=e.low=K+x,e.high=X+z+(K>>>0<x>>>0?1:0),L=n.low=L+y,n.high=Y+A+(L>>>0<y>>>0?1:0),M=r.low=M+B,r.high=Z+U+(M>>>0<B>>>0?1:0),N=G.low=N+h,G.high=$+l+(N>>>0<h>>>0?1:0),O=H.low=O+C,H.high=aa+R+(O>>>0<C>>>0?1:0),P=I.low=P+D,I.high=ba+S+(P>>>0<D>>>0?1:0),Q=f.low=Q+E,f.high=ca+V+(Q>>>0<E>>>0?1:0)},_doFinalize:function(){var a=this._data,d=a.words,f=8*this._nDataBytes,e=8*a.sigBytes;return d[e>>>5]|=128<<24-e%32,d[30+(e+128>>>10<<5)]=Math.floor(f/4294967296),d[31+(e+128>>>10<<5)]=f,a.sigBytes=4*d.length,this._process(),this._hash.toX32()},clone:function(){var a=r.clone.call(this);return a._hash=this._hash.clone(),a},blockSize:32}),n.SHA512=r._createHelper(e),n.HmacSHA512=r._createHmacHelper(e)}(),function(){var c=CryptoJS,b=(a=c.x64).Word,e=a.WordArray,d=(a=c.algo).SHA512,a=a.SHA384=d.extend({_doReset:function(){this._hash=new e.init([new b.init(3418070365,3238371032),new b.init(1654270250,914150663),new b.init(2438529370,812702999),new b.init(355462360,4144912697),new b.init(1731405415,4290775857),new b.init(2394180231,1750603025),new b.init(3675008525,1694076839),new b.init(1203062813,3204075428)])},_doFinalize:function(){var a=d._doFinalize.call(this);return a.sigBytes-=16,a}});c.SHA384=d._createHelper(a),c.HmacSHA384=d._createHmacHelper(a)}();var dbits,b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64pad="=";function hex2b64(d){var b,e,a="";for(b=0;b+3<=d.length;b+=3)e=parseInt(d.substring(b,b+3),16),a+=b64map.charAt(e>>6)+b64map.charAt(63&e);if(b+1==d.length?(e=parseInt(d.substring(b,b+1),16),a+=b64map.charAt(e<<2)):b+2==d.length&&(e=parseInt(d.substring(b,b+2),16),a+=b64map.charAt(e>>2)+b64map.charAt((3&e)<<4)),b64pad)for(;0<(3&a.length);)a+=b64pad;return a}function b64tohex(f){var e,c,a,d="",b=0;for(e=0;e<f.length&&f.charAt(e)!=b64pad;++e)(a=b64map.indexOf(f.charAt(e)))<0||(0==b?(d+=int2char(a>>2),c=3&a,b=1):1==b?(d+=int2char(c<<2|a>>4),c=15&a,b=2):2==b?(d+=int2char(c),d+=int2char(a>>2),c=3&a,b=3):(d+=int2char(c<<2|a>>4),d+=int2char(15&a),b=0));return 1==b&&(d+=int2char(c<<2)),d}function b64toBA(e){var c,d=b64tohex(e),b=new Array;for(c=0;2*c<d.length;++c)b[c]=parseInt(d.substring(2*c,2*c+2),16);return b}var canary=0xdeadbeefcafe,j_lm=15715070==(16777215&canary);function BigInteger(e,d,f){null!=e&&("number"==typeof e?this.fromNumber(e,d,f):null==d&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,d))}function nbi(){return new BigInteger(null)}function am1(f,a,b,e,h,g){for(;0<=--g;){var d=a*this[f++]+b[e]+h;h=Math.floor(d/67108864),b[e++]=67108863&d}return h}function am2(f,q,r,e,o,a){for(var k=32767&q,p=q>>15;0<=--a;){var d=32767&this[f],g=this[f++]>>15,b=p*d+g*k;o=((d=k*d+((32767&b)<<15)+r[e]+(1073741823&o))>>>30)+(b>>>15)+p*g+(o>>>30),r[e++]=1073741823&d}return o}function am3(f,q,r,e,o,a){for(var k=16383&q,p=q>>14;0<=--a;){var d=16383&this[f],g=this[f++]>>14,b=p*d+g*k;o=((d=k*d+((16383&b)<<14)+r[e]+o)>>28)+(b>>14)+p*g,r[e++]=268435455&d}return o}j_lm&&"Microsoft Internet Explorer"==navigator.appName?(BigInteger.prototype.am=am2,dbits=30):j_lm&&"Netscape"!=navigator.appName?(BigInteger.prototype.am=am1,dbits=26):(BigInteger.prototype.am=am3,dbits=28),BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP;var rr,vv,BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=new Array;for(rr="0".charCodeAt(0),vv=0;vv<=9;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(a){return BI_RM.charAt(a)}function intAt(b,a){var d=BI_RC[b.charCodeAt(a)];return null==d?-1:d}function bnpCopyTo(b){for(var a=this.t-1;0<=a;--a)b[a]=this[a];b.t=this.t,b.s=this.s}function bnpFromInt(a){this.t=1,this.s=a<0?-1:0,0<a?this[0]=a:a<-1?this[0]=a+this.DV:this.t=0}function nbv(a){var b=nbi();return b.fromInt(a),b}function bnpFromString(h,c){var e;if(16==c)e=4;else if(8==c)e=3;else if(256==c)e=8;else if(2==c)e=1;else if(32==c)e=5;else{if(4!=c)return void this.fromRadix(h,c);e=2}this.t=0,this.s=0;for(var g=h.length,d=!1,f=0;0<=--g;){var a=8==e?255&h[g]:intAt(h,g);a<0?"-"==h.charAt(g)&&(d=!0):(d=!1,0==f?this[this.t++]=a:f+e>this.DB?(this[this.t-1]|=(a&(1<<this.DB-f)-1)<<f,this[this.t++]=a>>this.DB-f):this[this.t-1]|=a<<f,(f+=e)>=this.DB&&(f-=this.DB))}8==e&&0!=(128&h[0])&&(this.s=-1,0<f&&(this[this.t-1]|=(1<<this.DB-f)-1<<f)),this.clamp(),d&&BigInteger.ZERO.subTo(this,this)}function bnpClamp(){for(var a=this.s&this.DM;0<this.t&&this[this.t-1]==a;)--this.t}function bnToString(c){if(this.s<0)return"-"+this.negate().toString(c);var e;if(16==c)e=4;else if(8==c)e=3;else if(2==c)e=1;else if(32==c)e=5;else{if(4!=c)return this.toRadix(c);e=2}var l,g=(1<<e)-1,a=!1,h="",f=this.t,j=this.DB-f*this.DB%e;if(0<f--)for(j<this.DB&&0<(l=this[f]>>j)&&(a=!0,h=int2char(l));0<=f;)j<e?(l=(this[f]&(1<<j)-1)<<e-j,l|=this[--f]>>(j+=this.DB-e)):(l=this[f]>>(j-=e)&g,j<=0&&(j+=this.DB,--f)),0<l&&(a=!0),a&&(h+=int2char(l));return a?h:"0"}function bnNegate(){var a=nbi();return BigInteger.ZERO.subTo(this,a),a}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(b){var d=this.s-b.s;if(0!=d)return d;var c=this.t;if(0!=(d=c-b.t))return this.s<0?-d:d;for(;0<=--c;)if(0!=(d=this[c]-b[c]))return d;return 0}function nbits(a){var b,c=1;return 0!=(b=a>>>16)&&(a=b,c+=16),0!=(b=a>>8)&&(a=b,c+=8),0!=(b=a>>4)&&(a=b,c+=4),0!=(b=a>>2)&&(a=b,c+=2),0!=(b=a>>1)&&(a=b,c+=1),c}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(c,b){var a;for(a=this.t-1;0<=a;--a)b[a+c]=this[a];for(a=c-1;0<=a;--a)b[a]=0;b.t=this.t+c,b.s=this.s}function bnpDRShiftTo(c,b){for(var a=c;a<this.t;++a)b[a-c]=this[a];b.t=Math.max(this.t-c,0),b.s=this.s}function bnpLShiftTo(j,e){var d,b=j%this.DB,a=this.DB-b,g=(1<<a)-1,f=Math.floor(j/this.DB),h=this.s<<b&this.DM;for(d=this.t-1;0<=d;--d)e[d+f+1]=this[d]>>a|h,h=(this[d]&g)<<b;for(d=f-1;0<=d;--d)e[d]=0;e[f]=h,e.t=this.t+f+1,e.s=this.s,e.clamp()}function bnpRShiftTo(g,d){d.s=this.s;var e=Math.floor(g/this.DB);if(e>=this.t)d.t=0;else{var b=g%this.DB,a=this.DB-b,f=(1<<b)-1;d[0]=this[e]>>b;for(var c=e+1;c<this.t;++c)d[c-e-1]|=(this[c]&f)<<a,d[c-e]=this[c]>>b;0<b&&(d[this.t-e-1]|=(this.s&f)<<a),d.t=this.t-e,d.clamp()}}function bnpSubTo(d,f){for(var e=0,g=0,b=Math.min(d.t,this.t);e<b;)g+=this[e]-d[e],f[e++]=g&this.DM,g>>=this.DB;if(d.t<this.t){for(g-=d.s;e<this.t;)g+=this[e],f[e++]=g&this.DM,g>>=this.DB;g+=this.s}else{for(g+=this.s;e<d.t;)g-=d[e],f[e++]=g&this.DM,g>>=this.DB;g-=d.s}f.s=g<0?-1:0,g<-1?f[e++]=this.DV+g:0<g&&(f[e++]=g),f.t=e,f.clamp()}function bnpMultiplyTo(c,e){var b=this.abs(),f=c.abs(),d=b.t;for(e.t=d+f.t;0<=--d;)e[d]=0;for(d=0;d<f.t;++d)e[d+b.t]=b.am(0,f[d],e,d,0,b.t);e.s=0,e.clamp(),this.s!=c.s&&BigInteger.ZERO.subTo(e,e)}function bnpSquareTo(d){for(var a=this.abs(),b=d.t=2*a.t;0<=--b;)d[b]=0;for(b=0;b<a.t-1;++b){var e=a.am(b,a[b],d,2*b,0,1);(d[b+a.t]+=a.am(b+1,2*a[b],d,2*b+1,e,a.t-b-1))>=a.DV&&(d[b+a.t]-=a.DV,d[b+a.t+1]=1)}0<d.t&&(d[d.t-1]+=a.am(b,a[b],d,2*b,0,1)),d.s=0,d.clamp()}function bnpDivRemTo(n,h,g){var w=n.abs();if(!(w.t<=0)){var k=this.abs();if(k.t<w.t)return null!=h&&h.fromInt(0),void(null!=g&&this.copyTo(g));null==g&&(g=nbi());var d=nbi(),a=this.s,l=n.s,v=this.DB-nbits(w[w.t-1]);0<v?(w.lShiftTo(v,d),k.lShiftTo(v,g)):(w.copyTo(d),k.copyTo(g));var p=d.t,b=d[p-1];if(0!=b){var o=b*(1<<this.F1)+(1<p?d[p-2]>>this.F2:0),A=this.FV/o,z=(1<<this.F1)/o,x=1<<this.F2,u=g.t,s=u-p,f=null==h?nbi():h;for(d.dlShiftTo(s,f),0<=g.compareTo(f)&&(g[g.t++]=1,g.subTo(f,g)),BigInteger.ONE.dlShiftTo(p,f),f.subTo(d,d);d.t<p;)d[d.t++]=0;for(;0<=--s;){var c=g[--u]==b?this.DM:Math.floor(g[u]*A+(g[u-1]+x)*z);if((g[u]+=d.am(0,c,g,s,0,p))<c)for(d.dlShiftTo(s,f),g.subTo(f,g);g[u]<--c;)g.subTo(f,g)}null!=h&&(g.drShiftTo(p,h),a!=l&&BigInteger.ZERO.subTo(h,h)),g.t=p,g.clamp(),0<v&&g.rShiftTo(v,g),a<0&&BigInteger.ZERO.subTo(g,g)}}}function bnMod(b){var c=nbi();return this.abs().divRemTo(b,null,c),this.s<0&&0<c.compareTo(BigInteger.ZERO)&&b.subTo(c,c),c}function Classic(a){this.m=a}function cConvert(a){return a.s<0||0<=a.compareTo(this.m)?a.mod(this.m):a}function cRevert(a){return a}function cReduce(a){a.divRemTo(this.m,null,a)}function cMulTo(a,c,b){a.multiplyTo(c,b),this.reduce(b)}function cSqrTo(a,b){a.squareTo(b),this.reduce(b)}function bnpInvDigit(){if(this.t<1)return 0;var a=this[0];if(0==(1&a))return 0;var b=3&a;return 0<(b=(b=(b=(b=b*(2-(15&a)*b)&15)*(2-(255&a)*b)&255)*(2-((65535&a)*b&65535))&65535)*(2-a*b%this.DV)%this.DV)?this.DV-b:-b}function Montgomery(a){this.m=a,this.mp=a.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<a.DB-15)-1,this.mt2=2*a.t}function montConvert(a){var b=nbi();return a.abs().dlShiftTo(this.m.t,b),b.divRemTo(this.m,null,b),a.s<0&&0<b.compareTo(BigInteger.ZERO)&&this.m.subTo(b,b),b}function montRevert(a){var b=nbi();return a.copyTo(b),this.reduce(b),b}function montReduce(a){for(;a.t<=this.mt2;)a[a.t++]=0;for(var c=0;c<this.m.t;++c){var b=32767&a[c],d=b*this.mpl+((b*this.mph+(a[c]>>15)*this.mpl&this.um)<<15)&a.DM;for(a[b=c+this.m.t]+=this.m.am(0,d,a,c,0,this.m.t);a[b]>=a.DV;)a[b]-=a.DV,a[++b]++}a.clamp(),a.drShiftTo(this.m.t,a),0<=a.compareTo(this.m)&&a.subTo(this.m,a)}function montSqrTo(a,b){a.squareTo(b),this.reduce(b)}function montMulTo(a,c,b){a.multiplyTo(c,b),this.reduce(b)}function bnpIsEven(){return 0==(0<this.t?1&this[0]:this.s)}function bnpExp(h,j){if(4294967295<h||h<1)return BigInteger.ONE;var f=nbi(),a=nbi(),d=j.convert(this),c=nbits(h)-1;for(d.copyTo(f);0<=--c;)if(j.sqrTo(f,a),0<(h&1<<c))j.mulTo(a,d,f);else{var b=f;f=a,a=b}return j.revert(f)}function bnModPowInt(b,a){var c;return c=b<256||a.isEven()?new Classic(a):new Montgomery(a),this.exp(b,c)}function bnClone(){var a=nbi();return this.copyTo(a),a}function bnIntValue(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return 0==this.t?this.s:this[0]<<24>>24}function bnShortValue(){return 0==this.t?this.s:this[0]<<16>>16}function bnpChunkSize(a){return Math.floor(Math.LN2*this.DB/Math.log(a))}function bnSigNum(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function bnpToRadix(c){if(null==c&&(c=10),0==this.signum()||c<2||36<c)return"0";var f=this.chunkSize(c),e=Math.pow(c,f),i=nbv(e),j=nbi(),h=nbi(),g="";for(this.divRemTo(i,j,h);0<j.signum();)g=(e+h.intValue()).toString(c).substr(1)+g,j.divRemTo(i,j,h);return h.intValue().toString(c)+g}function bnpFromRadix(m,h){this.fromInt(0),null==h&&(h=10);for(var f=this.chunkSize(h),g=Math.pow(h,f),e=!1,a=0,l=0,c=0;c<m.length;++c){var k=intAt(m,c);k<0?"-"==m.charAt(c)&&0==this.signum()&&(e=!0):(l=h*l+k,++a>=f&&(this.dMultiply(g),this.dAddOffset(l,0),l=a=0))}0<a&&(this.dMultiply(Math.pow(h,a)),this.dAddOffset(l,0)),e&&BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(f,e,h){if("number"==typeof e)if(f<2)this.fromInt(1);else for(this.fromNumber(f,h),this.testBit(f-1)||this.bitwiseTo(BigInteger.ONE.shiftLeft(f-1),op_or,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>f&&this.subTo(BigInteger.ONE.shiftLeft(f-1),this);else{var d=new Array,g=7&f;d.length=1+(f>>3),e.nextBytes(d),0<g?d[0]&=(1<<g)-1:d[0]=0,this.fromString(d,256)}}function bnToByteArray(){var b=this.t,c=new Array;c[0]=this.s;var f,e=this.DB-b*this.DB%8,a=0;if(0<b--)for(e<this.DB&&(f=this[b]>>e)!=(this.s&this.DM)>>e&&(c[a++]=f|this.s<<this.DB-e);0<=b;)e<8?(f=(this[b]&(1<<e)-1)<<8-e,f|=this[--b]>>(e+=this.DB-8)):(f=this[b]>>(e-=8)&255,e<=0&&(e+=this.DB,--b)),0!=(128&f)&&(f|=-256),0==a&&(128&this.s)!=(128&f)&&++a,(0<a||f!=this.s)&&(c[a++]=f);return c}function bnEquals(b){return 0==this.compareTo(b)}function bnMin(b){return this.compareTo(b)<0?this:b}function bnMax(b){return 0<this.compareTo(b)?this:b}function bnpBitwiseTo(c,h,e){var d,g,b=Math.min(c.t,this.t);for(d=0;d<b;++d)e[d]=h(this[d],c[d]);if(c.t<this.t){for(g=c.s&this.DM,d=b;d<this.t;++d)e[d]=h(this[d],g);e.t=this.t}else{for(g=this.s&this.DM,d=b;d<c.t;++d)e[d]=h(g,c[d]);e.t=c.t}e.s=h(this.s,c.s),e.clamp()}function op_and(a,b){return a&b}function bnAnd(b){var c=nbi();return this.bitwiseTo(b,op_and,c),c}function op_or(a,b){return a|b}function bnOr(b){var c=nbi();return this.bitwiseTo(b,op_or,c),c}function op_xor(a,b){return a^b}function bnXor(b){var c=nbi();return this.bitwiseTo(b,op_xor,c),c}function op_andnot(a,b){return a&~b}function bnAndNot(b){var c=nbi();return this.bitwiseTo(b,op_andnot,c),c}function bnNot(){for(var b=nbi(),a=0;a<this.t;++a)b[a]=this.DM&~this[a];return b.t=this.t,b.s=~this.s,b}function bnShiftLeft(b){var a=nbi();return b<0?this.rShiftTo(-b,a):this.lShiftTo(b,a),a}function bnShiftRight(b){var a=nbi();return b<0?this.lShiftTo(-b,a):this.rShiftTo(b,a),a}function lbit(a){if(0==a)return-1;var b=0;return 0==(65535&a)&&(a>>=16,b+=16),0==(255&a)&&(a>>=8,b+=8),0==(15&a)&&(a>>=4,b+=4),0==(3&a)&&(a>>=2,b+=2),0==(1&a)&&++b,b}function bnGetLowestSetBit(){for(var a=0;a<this.t;++a)if(0!=this[a])return a*this.DB+lbit(this[a]);return this.s<0?this.t*this.DB:-1}function cbit(a){for(var b=0;0!=a;)a&=a-1,++b;return b}function bnBitCount(){for(var c=0,a=this.s&this.DM,b=0;b<this.t;++b)c+=cbit(this[b]^a);return c}function bnTestBit(b){var a=Math.floor(b/this.DB);return a>=this.t?0!=this.s:0!=(this[a]&1<<b%this.DB)}function bnpChangeBit(c,b){var a=BigInteger.ONE.shiftLeft(c);return this.bitwiseTo(a,b,a),a}function bnSetBit(a){return this.changeBit(a,op_or)}function bnClearBit(a){return this.changeBit(a,op_andnot)}function bnFlipBit(a){return this.changeBit(a,op_xor)}function bnpAddTo(d,f){for(var e=0,g=0,b=Math.min(d.t,this.t);e<b;)g+=this[e]+d[e],f[e++]=g&this.DM,g>>=this.DB;if(d.t<this.t){for(g+=d.s;e<this.t;)g+=this[e],f[e++]=g&this.DM,g>>=this.DB;g+=this.s}else{for(g+=this.s;e<d.t;)g+=d[e],f[e++]=g&this.DM,g>>=this.DB;g+=d.s}f.s=g<0?-1:0,0<g?f[e++]=g:g<-1&&(f[e++]=this.DV+g),f.t=e,f.clamp()}function bnAdd(b){var c=nbi();return this.addTo(b,c),c}function bnSubtract(b){var c=nbi();return this.subTo(b,c),c}function bnMultiply(b){var c=nbi();return this.multiplyTo(b,c),c}function bnSquare(){var a=nbi();return this.squareTo(a),a}function bnDivide(b){var c=nbi();return this.divRemTo(b,c,null),c}function bnRemainder(b){var c=nbi();return this.divRemTo(b,null,c),c}function bnDivideAndRemainder(b){var d=nbi(),c=nbi();return this.divRemTo(b,d,c),new Array(d,c)}function bnpDMultiply(a){this[this.t]=this.am(0,a-1,this,0,0,this.t),++this.t,this.clamp()}function bnpDAddOffset(b,a){if(0!=b){for(;this.t<=a;)this[this.t++]=0;for(this[a]+=b;this[a]>=this.DV;)this[a]-=this.DV,++a>=this.t&&(this[this.t++]=0),++this[a]}}function NullExp(){}function nNop(a){return a}function nMulTo(a,c,b){a.multiplyTo(c,b)}function nSqrTo(a,b){a.squareTo(b)}function bnPow(a){return this.exp(a,new NullExp)}function bnpMultiplyLowerTo(b,f,e){var c,d=Math.min(this.t+b.t,f);for(e.s=0,e.t=d;0<d;)e[--d]=0;for(c=e.t-this.t;d<c;++d)e[d+this.t]=this.am(0,b[d],e,d,0,this.t);for(c=Math.min(b.t,f);d<c;++d)this.am(0,b[d],e,d,0,f-d);e.clamp()}function bnpMultiplyUpperTo(b,e,d){--e;var c=d.t=this.t+b.t-e;for(d.s=0;0<=--c;)d[c]=0;for(c=Math.max(e-this.t,0);c<b.t;++c)d[this.t+c-e]=this.am(e-c,b[c],d,0,0,this.t+c-e);d.clamp(),d.drShiftTo(1,d)}function Barrett(a){this.r2=nbi(),this.q3=nbi(),BigInteger.ONE.dlShiftTo(2*a.t,this.r2),this.mu=this.r2.divide(a),this.m=a}function barrettConvert(a){if(a.s<0||a.t>2*this.m.t)return a.mod(this.m);if(a.compareTo(this.m)<0)return a;var b=nbi();return a.copyTo(b),this.reduce(b),b}function barrettRevert(a){return a}function barrettReduce(a){for(a.drShiftTo(this.m.t-1,this.r2),a.t>this.m.t+1&&(a.t=this.m.t+1,a.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);a.compareTo(this.r2)<0;)a.dAddOffset(1,this.m.t+1);for(a.subTo(this.r2,a);0<=a.compareTo(this.m);)a.subTo(this.m,a)}function barrettSqrTo(a,b){a.squareTo(b),this.reduce(b)}function barrettMulTo(a,c,b){a.multiplyTo(c,b),this.reduce(b)}function bnModPow(q,f){var h,v,o=q.bitLength(),b=nbv(1);if(o<=0)return b;h=o<18?1:o<48?3:o<144?4:o<768?5:6,v=o<8?new Classic(f):f.isEven()?new Barrett(f):new Montgomery(f);var p=new Array,d=3,s=h-1,a=(1<<h)-1;if(p[1]=v.convert(this),1<h){var A=nbi();for(v.sqrTo(p[1],A);d<=a;)p[d]=nbi(),v.mulTo(A,p[d-2],p[d]),d+=2}var x,y,l=q.t-1,u=!0,c=nbi();for(o=nbits(q[l])-1;0<=l;){for(s<=o?x=q[l]>>o-s&a:(x=(q[l]&(1<<o+1)-1)<<s-o,0<l&&(x|=q[l-1]>>this.DB+o-s)),d=h;0==(1&x);)x>>=1,--d;if((o-=d)<0&&(o+=this.DB,--l),u)p[x].copyTo(b),u=!1;else{for(;1<d;)v.sqrTo(b,c),v.sqrTo(c,b),d-=2;0<d?v.sqrTo(b,c):(y=b,b=c,c=y),v.mulTo(c,p[x],b)}for(;0<=l&&0==(q[l]&1<<o);)v.sqrTo(b,c),y=b,b=c,c=y,--o<0&&(o=this.DB-1,--l)}return v.revert(b)}function bnGCD(c){var b=this.s<0?this.negate():this.clone(),h=c.s<0?c.negate():c.clone();if(b.compareTo(h)<0){var e=b;b=h,h=e}var d=b.getLowestSetBit(),f=h.getLowestSetBit();if(f<0)return b;for(d<f&&(f=d),0<f&&(b.rShiftTo(f,b),h.rShiftTo(f,h));0<b.signum();)0<(d=b.getLowestSetBit())&&b.rShiftTo(d,b),0<(d=h.getLowestSetBit())&&h.rShiftTo(d,h),0<=b.compareTo(h)?(b.subTo(h,b),b.rShiftTo(1,b)):(h.subTo(b,h),h.rShiftTo(1,h));return 0<f&&h.lShiftTo(f,h),h}function bnpModInt(e){if(e<=0)return 0;var c=this.DV%e,b=this.s<0?e-1:0;if(0<this.t)if(0==c)b=this[0]%e;else for(var a=this.t-1;0<=a;--a)b=(c*b+this[a])%e;return b}function bnModInverse(f){var j=f.isEven();if(this.isEven()&&j||0==f.signum())return BigInteger.ZERO;for(var i=f.clone(),h=this.clone(),g=nbv(1),e=nbv(0),l=nbv(0),k=nbv(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),j?(g.isEven()&&e.isEven()||(g.addTo(this,g),e.subTo(f,e)),g.rShiftTo(1,g)):e.isEven()||e.subTo(f,e),e.rShiftTo(1,e);for(;h.isEven();)h.rShiftTo(1,h),j?(l.isEven()&&k.isEven()||(l.addTo(this,l),k.subTo(f,k)),l.rShiftTo(1,l)):k.isEven()||k.subTo(f,k),k.rShiftTo(1,k);0<=i.compareTo(h)?(i.subTo(h,i),j&&g.subTo(l,g),e.subTo(k,e)):(h.subTo(i,h),j&&l.subTo(g,l),k.subTo(e,k))}return 0!=h.compareTo(BigInteger.ONE)?BigInteger.ZERO:0<=k.compareTo(f)?k.subtract(f):k.signum()<0?(k.addTo(f,k),k.signum()<0?k.add(f):k):k}Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.ZERO=nbv(0),BigInteger.ONE=nbv(1),NullExp.prototype.convert=nNop,NullExp.prototype.revert=nNop,NullExp.prototype.mulTo=nMulTo,NullExp.prototype.sqrTo=nSqrTo,Barrett.prototype.convert=barrettConvert,Barrett.prototype.revert=barrettRevert,Barrett.prototype.reduce=barrettReduce,Barrett.prototype.mulTo=barrettMulTo,Barrett.prototype.sqrTo=barrettSqrTo;var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(e){var d,b=this.abs();if(1==b.t&&b[0]<=lowprimes[lowprimes.length-1]){for(d=0;d<lowprimes.length;++d)if(b[0]==lowprimes[d])return!0;return!1}if(b.isEven())return!1;for(d=1;d<lowprimes.length;){for(var a=lowprimes[d],c=d+1;c<lowprimes.length&&a<lplim;)a*=lowprimes[c++];for(a=b.modInt(a);d<c;)if(a%lowprimes[d++]==0)return!1}return b.millerRabin(e)}function bnpMillerRabin(f){var g=this.subtract(BigInteger.ONE),c=g.getLowestSetBit();if(c<=0)return!1;var h=g.shiftRight(c);(f=f+1>>1)>lowprimes.length&&(f=lowprimes.length);for(var b=nbi(),e=0;e<f;++e){b.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var l=b.modPow(h,this);if(0!=l.compareTo(BigInteger.ONE)&&0!=l.compareTo(g)){for(var d=1;d++<c&&0!=l.compareTo(g);)if(0==(l=l.modPowInt(2,this)).compareTo(BigInteger.ONE))return!1;if(0!=l.compareTo(g))return!1}}return!0}function parseBigInt(b,a){return new BigInteger(b,a)}function linebrk(c,d){for(var a="",b=0;b+d<c.length;)a+=c.substring(b,b+d)+"\n",b+=d;return a+c.substring(b,c.length)}function byte2Hex(a){return a<16?"0"+a.toString(16):a.toString(16)}function pkcs1pad2(e,h){if(h<e.length+11)return alert("Message too long for RSA"),null;for(var g=new Array,d=e.length-1;0<=d&&0<h;){var f=e.charCodeAt(d--);f<128?g[--h]=f:127<f&&f<2048?(g[--h]=63&f|128,g[--h]=f>>6|192):(g[--h]=63&f|128,g[--h]=f>>6&63|128,g[--h]=f>>12|224)}g[--h]=0;for(var b=new SecureRandom,a=new Array;2<h;){for(a[0]=0;0==a[0];)b.nextBytes(a);g[--h]=a[0]}return g[--h]=2,g[--h]=0,new BigInteger(g)}function oaep_mgf1_arr(c,a,e){for(var b="",d=0;b.length<a;)b+=e(String.fromCharCode.apply(String,c.concat([(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d]))),d+=1;return b}BigInteger.prototype.chunkSize=bnpChunkSize,BigInteger.prototype.toRadix=bnpToRadix,BigInteger.prototype.fromRadix=bnpFromRadix,BigInteger.prototype.fromNumber=bnpFromNumber,BigInteger.prototype.bitwiseTo=bnpBitwiseTo,BigInteger.prototype.changeBit=bnpChangeBit,BigInteger.prototype.addTo=bnpAddTo,BigInteger.prototype.dMultiply=bnpDMultiply,BigInteger.prototype.dAddOffset=bnpDAddOffset,BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo,BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo,BigInteger.prototype.modInt=bnpModInt,BigInteger.prototype.millerRabin=bnpMillerRabin,BigInteger.prototype.clone=bnClone,BigInteger.prototype.intValue=bnIntValue,BigInteger.prototype.byteValue=bnByteValue,BigInteger.prototype.shortValue=bnShortValue,BigInteger.prototype.signum=bnSigNum,BigInteger.prototype.toByteArray=bnToByteArray,BigInteger.prototype.equals=bnEquals,BigInteger.prototype.min=bnMin,BigInteger.prototype.max=bnMax,BigInteger.prototype.and=bnAnd,BigInteger.prototype.or=bnOr,BigInteger.prototype.xor=bnXor,BigInteger.prototype.andNot=bnAndNot,BigInteger.prototype.not=bnNot,BigInteger.prototype.shiftLeft=bnShiftLeft,BigInteger.prototype.shiftRight=bnShiftRight,BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit,BigInteger.prototype.bitCount=bnBitCount,BigInteger.prototype.testBit=bnTestBit,BigInteger.prototype.setBit=bnSetBit,BigInteger.prototype.clearBit=bnClearBit,BigInteger.prototype.flipBit=bnFlipBit,BigInteger.prototype.add=bnAdd,BigInteger.prototype.subtract=bnSubtract,BigInteger.prototype.multiply=bnMultiply,BigInteger.prototype.divide=bnDivide,BigInteger.prototype.remainder=bnRemainder,BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder,BigInteger.prototype.modPow=bnModPow,BigInteger.prototype.modInverse=bnModInverse,BigInteger.prototype.pow=bnPow,BigInteger.prototype.gcd=bnGCD,BigInteger.prototype.isProbablePrime=bnIsProbablePrime,BigInteger.prototype.square=bnSquare;var SHA1_SIZE=20;function oaep_pad(l,a,c){if(l.length+2*SHA1_SIZE+2>a)throw"Message too long for RSA";var d,h="";for(d=0;d<a-l.length-2*SHA1_SIZE-2;d+=1)h+="\0";var e=rstr_sha1("")+h+""+l,f=new Array(SHA1_SIZE);(new SecureRandom).nextBytes(f);var g=oaep_mgf1_arr(f,e.length,c||rstr_sha1),k=[];for(d=0;d<e.length;d+=1)k[d]=e.charCodeAt(d)^g.charCodeAt(d);var j=oaep_mgf1_arr(k,f.length,rstr_sha1),b=[0];for(d=0;d<f.length;d+=1)b[d+1]=f[d]^j.charCodeAt(d);return new BigInteger(b.concat(k))}function RSAKey(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}function RSASetPublic(b,a){this.isPublic=!0,"string"!=typeof b?(this.n=b,this.e=a):null!=b&&null!=a&&0<b.length&&0<a.length?(this.n=parseBigInt(b,16),this.e=parseInt(a,16)):alert("Invalid RSA public key")}function RSADoPublic(a){return a.modPowInt(this.e,this.n)}function RSAEncrypt(d){var a=pkcs1pad2(d,this.n.bitLength()+7>>3);if(null==a)return null;var e=this.doPublic(a);if(null==e)return null;var b=e.toString(16);return 0==(1&b.length)?b:"0"+b}function RSAEncryptOAEP(e,d){var a=oaep_pad(e,this.n.bitLength()+7>>3,d);if(null==a)return null;var f=this.doPublic(a);if(null==f)return null;var b=f.toString(16);return 0==(1&b.length)?b:"0"+b}function pkcs1unpad2(g,j){for(var a=g.toByteArray(),f=0;f<a.length&&0==a[f];)++f;if(a.length-f!=j-1||2!=a[f])return null;for(++f;0!=a[f];)if(++f>=a.length)return null;for(var e="";++f<a.length;){var h=255&a[f];h<128?e+=String.fromCharCode(h):191<h&&h<224?(e+=String.fromCharCode((31&h)<<6|63&a[f+1]),++f):(e+=String.fromCharCode((15&h)<<12|(63&a[f+1])<<6|63&a[f+2]),f+=2)}return e}function oaep_mgf1_str(c,a,e){for(var b="",d=0;b.length<a;)b+=e(c+String.fromCharCode.apply(String,[(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d])),d+=1;return b}RSAKey.prototype.doPublic=RSADoPublic,RSAKey.prototype.setPublic=RSASetPublic,RSAKey.prototype.encrypt=RSAEncrypt,RSAKey.prototype.encryptOAEP=RSAEncryptOAEP,RSAKey.prototype.type="RSA";SHA1_SIZE=20;function oaep_unpad(l,b,e){for(l=l.toByteArray(),f=0;f<l.length;f+=1)l[f]&=255;for(;l.length<b;)l.unshift(0);if((l=String.fromCharCode.apply(String,l)).length<2*SHA1_SIZE+2)throw"Cipher too short";var f,c=l.substr(1,SHA1_SIZE),o=l.substr(SHA1_SIZE+1),m=oaep_mgf1_str(o,SHA1_SIZE,e||rstr_sha1),h=[];for(f=0;f<c.length;f+=1)h[f]=c.charCodeAt(f)^m.charCodeAt(f);var j=oaep_mgf1_str(String.fromCharCode.apply(String,h),l.length-SHA1_SIZE,rstr_sha1),g=[];for(f=0;f<o.length;f+=1)g[f]=o.charCodeAt(f)^j.charCodeAt(f);if((g=String.fromCharCode.apply(String,g)).substr(0,SHA1_SIZE)!==rstr_sha1(""))throw"Hash mismatch";var a=(g=g.substr(SHA1_SIZE)).indexOf("");if((-1!=a?g.substr(0,a).lastIndexOf("\0"):-1)+1!=a)throw"Malformed data";return g.substr(a+1)}function RSASetPrivate(c,a,b){this.isPrivate=!0,"string"!=typeof c?(this.n=c,this.e=a,this.d=b):null!=c&&null!=a&&0<c.length&&0<a.length?(this.n=parseBigInt(c,16),this.e=parseInt(a,16),this.d=parseBigInt(b,16)):alert("Invalid RSA private key")}function RSASetPrivateEx(g,d,e,c,b,a,h,f){if(this.isPrivate=!0,null==g)throw"RSASetPrivateEx N == null";if(null==d)throw"RSASetPrivateEx E == null";if(0==g.length)throw"RSASetPrivateEx N.length == 0";if(0==d.length)throw"RSASetPrivateEx E.length == 0";null!=g&&null!=d&&0<g.length&&0<d.length?(this.n=parseBigInt(g,16),this.e=parseInt(d,16),this.d=parseBigInt(e,16),this.p=parseBigInt(c,16),this.q=parseBigInt(b,16),this.dmp1=parseBigInt(a,16),this.dmq1=parseBigInt(h,16),this.coeff=parseBigInt(f,16)):alert("Invalid RSA private key in RSASetPrivateEx")}function RSAGenerate(b,i){var a=new SecureRandom,f=b>>1;this.e=parseInt(i,16);for(var c=new BigInteger(i,16);;){for(;this.p=new BigInteger(b-f,1,a),0!=this.p.subtract(BigInteger.ONE).gcd(c).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(f,1,a),0!=this.q.subtract(BigInteger.ONE).gcd(c).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var h=this.p;this.p=this.q,this.q=h}var g=this.p.subtract(BigInteger.ONE),d=this.q.subtract(BigInteger.ONE),e=g.multiply(d);if(0==e.gcd(c).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=c.modInverse(e),this.dmp1=this.d.mod(g),this.dmq1=this.d.mod(d),this.coeff=this.q.modInverse(this.p);break}}}function RSADoPrivate(a){if(null==this.p||null==this.q)return a.modPow(this.d,this.n);for(var c=a.mod(this.p).modPow(this.dmp1,this.p),b=a.mod(this.q).modPow(this.dmq1,this.q);c.compareTo(b)<0;)c=c.add(this.p);return c.subtract(b).multiply(this.coeff).mod(this.p).multiply(this.q).add(b)}function RSADecrypt(b){var d=parseBigInt(b,16),a=this.doPrivate(d);return null==a?null:pkcs1unpad2(a,this.n.bitLength()+7>>3)}function RSADecryptOAEP(d,b){var e=parseBigInt(d,16),a=this.doPrivate(e);return null==a?null:oaep_unpad(a,this.n.bitLength()+7>>3,b)}function _rsapem_pemToBase64(b){var a=b;return a=(a=(a=a.replace("-----BEGIN RSA PRIVATE KEY-----","")).replace("-----END RSA PRIVATE KEY-----","")).replace(/[ \n]+/g,"")}function _rsapem_getPosArrayOfChildrenFromHex(d){var j=new Array,k=ASN1HEX.getStartPosOfV_AtObj(d,0),f=ASN1HEX.getPosOfNextSibling_AtObj(d,k),h=ASN1HEX.getPosOfNextSibling_AtObj(d,f),b=ASN1HEX.getPosOfNextSibling_AtObj(d,h),l=ASN1HEX.getPosOfNextSibling_AtObj(d,b),e=ASN1HEX.getPosOfNextSibling_AtObj(d,l),g=ASN1HEX.getPosOfNextSibling_AtObj(d,e),c=ASN1HEX.getPosOfNextSibling_AtObj(d,g),i=ASN1HEX.getPosOfNextSibling_AtObj(d,c);return j.push(k,f,h,b,l,e,g,c,i),j}function _rsapem_getHexValueArrayOfChildrenFromHex(i){var o=_rsapem_getPosArrayOfChildrenFromHex(i),r=ASN1HEX.getHexOfV_AtObj(i,o[0]),f=ASN1HEX.getHexOfV_AtObj(i,o[1]),j=ASN1HEX.getHexOfV_AtObj(i,o[2]),k=ASN1HEX.getHexOfV_AtObj(i,o[3]),c=ASN1HEX.getHexOfV_AtObj(i,o[4]),b=ASN1HEX.getHexOfV_AtObj(i,o[5]),h=ASN1HEX.getHexOfV_AtObj(i,o[6]),g=ASN1HEX.getHexOfV_AtObj(i,o[7]),l=ASN1HEX.getHexOfV_AtObj(i,o[8]),m=new Array;return m.push(r,f,j,k,c,b,h,g,l),m}function _rsapem_readPrivateKeyFromASN1HexString(c){var b=_rsapem_getHexValueArrayOfChildrenFromHex(c);this.setPrivateEx(b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8])}function _rsapem_readPrivateKeyFromPEMString(e){var b=_rsapem_getHexValueArrayOfChildrenFromHex(b64tohex(_rsapem_pemToBase64(e)));this.setPrivateEx(b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8])}RSAKey.prototype.doPrivate=RSADoPrivate,RSAKey.prototype.setPrivate=RSASetPrivate,RSAKey.prototype.setPrivateEx=RSASetPrivateEx,RSAKey.prototype.generate=RSAGenerate,RSAKey.prototype.decrypt=RSADecrypt,RSAKey.prototype.decryptOAEP=RSADecryptOAEP,RSAKey.prototype.readPrivateKeyFromPEMString=_rsapem_readPrivateKeyFromPEMString,RSAKey.prototype.readPrivateKeyFromASN1HexString=_rsapem_readPrivateKeyFromASN1HexString;var _RE_HEXDECONLY=new RegExp("");function _rsasign_getHexPaddedDigestInfoForString(d,e,a){var f,c=(f=d,KJUR.crypto.Util.hashString(f,a));return KJUR.crypto.Util.getPaddedDigestInfoHex(c,a,e)}function _zeroPaddingOfSignature(e,d){for(var c="",a=d/4-e.length,b=0;b<a;b++)c+="0";return c+e}function _rsasign_signString(d,a){var e,c=(e=d,KJUR.crypto.Util.hashString(e,a));return this.signWithMessageHash(c,a)}function _rsasign_signWithMessageHash(e,c){var b=parseBigInt(KJUR.crypto.Util.getPaddedDigestInfoHex(e,c,this.n.bitLength()),16);return _zeroPaddingOfSignature(this.doPrivate(b).toString(16),this.n.bitLength())}function _rsasign_signStringWithSHA1(a){return _rsasign_signString.call(this,a,"sha1")}function _rsasign_signStringWithSHA256(a){return _rsasign_signString.call(this,a,"sha256")}function pss_mgf1_str(c,a,e){for(var b="",d=0;b.length<a;)b+=hextorstr(e(rstrtohex(c+String.fromCharCode.apply(String,[(4278190080&d)>>24,(16711680&d)>>16,(65280&d)>>8,255&d])))),d+=1;return b}function _rsasign_signStringPSS(e,a,d){var f,b=(f=rstrtohex(e),KJUR.crypto.Util.hashHex(f,a));return void 0===d&&(d=-1),this.signWithMessageHashPSS(b,a,d)}function _rsasign_signWithMessageHashPSS(l,a,k){var d,b=hextorstr(l),g=b.length,m=this.n.bitLength()-1,c=Math.ceil(m/8),o=function(i){return KJUR.crypto.Util.hashHex(i,a)};if(-1===k||void 0===k)k=g;else if(-2===k)k=c-g-2;else if(k<-2)throw"invalid salt length";if(c<g+k+2)throw"data too long";var f="";0<k&&(f=new Array(k),(new SecureRandom).nextBytes(f),f=String.fromCharCode.apply(String,f));var n=hextorstr(o(rstrtohex("\0\0\0\0\0\0\0\0"+b+f))),j=[];for(d=0;d<c-k-g-2;d+=1)j[d]=0;var e=String.fromCharCode.apply(String,j)+""+f,h=pss_mgf1_str(n,e.length,o),q=[];for(d=0;d<e.length;d+=1)q[d]=e.charCodeAt(d)^h.charCodeAt(d);var p=65280>>8*c-m&255;for(q[0]&=~p,d=0;d<g;d++)q.push(n.charCodeAt(d));return q.push(188),_zeroPaddingOfSignature(this.doPrivate(new BigInteger(q)).toString(16),this.n.bitLength())}function _rsasign_getDecryptSignatureBI(a,d,c){var b=new RSAKey;return b.setPublic(d,c),b.doPublic(a)}function _rsasign_getHexDigestInfoFromSig(a,c,b){return _rsasign_getDecryptSignatureBI(a,c,b).toString(16).replace(/^1f+00/,"")}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(f){for(var e in KJUR.crypto.Util.DIGESTINFOHEAD){var d=KJUR.crypto.Util.DIGESTINFOHEAD[e],b=d.length;if(f.substring(0,b)==d)return[e,f.substring(b)]}return[]}function _rsasign_verifySignatureWithArgs(f,b,g,j){var h=_rsasign_getAlgNameAndHashFromHexDisgestInfo(_rsasign_getHexDigestInfoFromSig(b,g,j));if(0==h.length)return!1;var k,d=h[0];return h[1]==(k=f,KJUR.crypto.Util.hashString(k,d))}function _rsasign_verifyHexSignatureForMessage(c,b){return _rsasign_verifySignatureWithArgs(b,parseBigInt(c,16),this.n.toString(16),this.e.toString(16))}function _rsasign_verifyString(f,j){var b=parseBigInt(j=(j=j.replace(_RE_HEXDECONLY,"")).replace(/[ \n]+/g,""),16);if(b.bitLength()>this.n.bitLength())return 0;var g=_rsasign_getAlgNameAndHashFromHexDisgestInfo(this.doPublic(b).toString(16).replace(/^1f+00/,""));if(0==g.length)return!1;var k,d=g[0];return g[1]==(k=f,KJUR.crypto.Util.hashString(k,d))}function _rsasign_verifyWithMessageHash(e,a){var b=parseBigInt(a=(a=a.replace(_RE_HEXDECONLY,"")).replace(/[ \n]+/g,""),16);if(b.bitLength()>this.n.bitLength())return 0;var c=_rsasign_getAlgNameAndHashFromHexDisgestInfo(this.doPublic(b).toString(16).replace(/^1f+00/,""));if(0==c.length)return!1;c[0];return c[1]==e}function _rsasign_verifyStringPSS(c,b,a,f){var g,d=(g=rstrtohex(c),KJUR.crypto.Util.hashHex(g,a));return void 0===f&&(f=-1),this.verifyWithMessageHashPSS(d,b,a,f)}function _rsasign_verifyWithMessageHashPSS(f,s,l,c){var k=new BigInteger(s,16);if(k.bitLength()>this.n.bitLength())return!1;var q,r=function(i){return KJUR.crypto.Util.hashHex(i,l)},j=hextorstr(f),h=j.length,g=this.n.bitLength()-1,m=Math.ceil(g/8);if(-1===c||void 0===c)c=h;else if(-2===c)c=m-h-2;else if(c<-2)throw"invalid salt length";if(m<h+c+2)throw"data too long";var a=this.doPublic(k).toByteArray();for(q=0;q<a.length;q+=1)a[q]&=255;for(;a.length<m;)a.unshift(0);if(188!==a[m-1])throw"encoded message does not end in 0xbc";var d=(a=String.fromCharCode.apply(String,a)).substr(0,m-h-1),e=a.substr(d.length,h),p=65280>>8*m-g&255;if(0!=(d.charCodeAt(0)&p))throw"bits beyond keysize not zero";var n=pss_mgf1_str(e,d.length,r),o=[];for(q=0;q<d.length;q+=1)o[q]=d.charCodeAt(q)^n.charCodeAt(q);o[0]&=~p;var b=m-h-c-2;for(q=0;q<b;q+=1)if(0!==o[q])throw"leftmost octets not zero";if(1!==o[b])throw"0x01 marker not found";return e===hextorstr(r(rstrtohex("\0\0\0\0\0\0\0\0"+j+String.fromCharCode.apply(String,o.slice(-c)))))}_RE_HEXDECONLY.compile("[^0-9a-f]","gi"),RSAKey.prototype.signWithMessageHash=_rsasign_signWithMessageHash,RSAKey.prototype.signString=_rsasign_signString,RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.sign=_rsasign_signString,RSAKey.prototype.signWithSHA1=_rsasign_signStringWithSHA1,RSAKey.prototype.signWithSHA256=_rsasign_signStringWithSHA256,RSAKey.prototype.signWithMessageHashPSS=_rsasign_signWithMessageHashPSS,RSAKey.prototype.signStringPSS=_rsasign_signStringPSS,RSAKey.prototype.signPSS=_rsasign_signStringPSS,RSAKey.SALT_LEN_HLEN=-1,RSAKey.SALT_LEN_MAX=-2,RSAKey.prototype.verifyWithMessageHash=_rsasign_verifyWithMessageHash,RSAKey.prototype.verifyString=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verify=_rsasign_verifyString,RSAKey.prototype.verifyHexSignatureForByteArrayMessage=_rsasign_verifyHexSignatureForMessage,RSAKey.prototype.verifyWithMessageHashPSS=_rsasign_verifyWithMessageHashPSS,RSAKey.prototype.verifyStringPSS=_rsasign_verifyStringPSS,RSAKey.prototype.verifyPSS=_rsasign_verifyStringPSS,RSAKey.SALT_LEN_RECOVER=-2;var KJUR,utf8tob64u,b64utoutf8,ASN1HEX=new function(){};function X509(){this.subjectPublicKeyRSA=null,this.subjectPublicKeyRSA_hN=null,this.subjectPublicKeyRSA_hE=null,this.hex=null,this.getSerialNumberHex=function(){return ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,1])},this.getSignatureAlgorithmField=function(){var sigAlgOidHex=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,2,0]),sigAlgOidInt=KJUR.asn1.ASN1Util.oidHexToInt(sigAlgOidHex);return KJUR.asn1.x509.OID.oid2name(sigAlgOidInt)},this.getIssuerHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3])},this.getIssuerString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3]))},this.getSubjectHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5])},this.getSubjectString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5]))},this.getNotBefore=function(){var s=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,0]);return s=s.replace(/(..)/g,"%$1"),s=decodeURIComponent(s)},this.getNotAfter=function(){var s=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,1]);return s=s.replace(/(..)/g,"%$1"),s=decodeURIComponent(s)},this.readCertPEM=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM),a=X509.getPublicKeyHexArrayFromCertHex(hCert),rsa=new RSAKey;rsa.setPublic(a[0],a[1]),this.subjectPublicKeyRSA=rsa,this.subjectPublicKeyRSA_hN=a[0],this.subjectPublicKeyRSA_hE=a[1],this.hex=hCert},this.readCertPEMWithoutRSAInit=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM),a=X509.getPublicKeyHexArrayFromCertHex(hCert);"function"==typeof this.subjectPublicKeyRSA.setPublic&&this.subjectPublicKeyRSA.setPublic(a[0],a[1]),this.subjectPublicKeyRSA_hN=a[0],this.subjectPublicKeyRSA_hE=a[1],this.hex=hCert},this.getInfo=function(){var s="Basic Fields\n";s+=" serial number: "+this.getSerialNumberHex()+"\n",s+=" signature algorithm: "+this.getSignatureAlgorithmField()+"\n",s+=" issuer: "+this.getIssuerString()+"\n",s+=" notBefore: "+this.getNotBefore()+"\n",s+=" notAfter: "+this.getNotAfter()+"\n",s+=" subject: "+this.getSubjectString()+"\n",s+=" subject public key info: \n";var pSPKI=X509.getSubjectPublicKeyInfoPosFromCertHex(this.hex),hSPKI=ASN1HEX.getHexOfTLV_AtObj(this.hex,pSPKI),keyObj=KEYUTIL.getKey(hSPKI,null,"pkcs8pub");keyObj instanceof RSAKey&&(s+=" key algorithm: RSA\n",s+=" n="+keyObj.n.toString(16).substr(0,16)+"...\n",s+=" e="+keyObj.e.toString(16)+"\n"),s+="X509v3 Extensions:\n";for(var aExt=X509.getV3ExtInfoListOfCertHex(this.hex),i=0;i<aExt.length;i++){var info=aExt[i],extName=KJUR.asn1.x509.OID.oid2name(info.oid);""===extName&&(extName=info.oid);var critical="";if(!0===info.critical&&(critical="CRITICAL"),s+=" "+extName+" "+critical+":\n","basicConstraints"===extName){var bc=X509.getExtBasicConstraints(this.hex);void 0===bc.cA?s+=" {}\n":(s+=" cA=true",void 0!==bc.pathLen&&(s+=", pathLen="+bc.pathLen),s+="\n")}else if("keyUsage"===extName)s+=" "+X509.getExtKeyUsageString(this.hex)+"\n";else if("subjectKeyIdentifier"===extName)s+=" "+X509.getExtSubjectKeyIdentifier(this.hex)+"\n";else if("authorityKeyIdentifier"===extName){var akid=X509.getExtAuthorityKeyIdentifier(this.hex);void 0!==akid.kid&&(s+=" kid="+akid.kid+"\n")}else if("extKeyUsage"===extName){s+=" "+X509.getExtExtKeyUsageName(this.hex).join(", ")+"\n"}else if("subjectAltName"===extName){s+=" "+X509.getExtSubjectAltName(this.hex).join(", ")+"\n"}else if("cRLDistributionPoints"===extName){s+=" "+X509.getExtCRLDistributionPointsURI(this.hex)+"\n"}else if("authorityInfoAccess"===extName){var aia=X509.getExtAIAInfo(this.hex);void 0!==aia.ocsp&&(s+=" ocsp: "+aia.ocsp.join(",")+"\n"),void 0!==aia.caissuer&&(s+=" caissuer: "+aia.caissuer.join(",")+"\n")}}return s+="signature algorithm: "+X509.getSignatureAlgorithmName(this.hex)+"\n",s+="signature: "+X509.getSignatureValueHex(this.hex).substr(0,16)+"...\n"}}function Base64x(){}function stoBA(s){for(var a=new Array,i=0;i<s.length;i++)a[i]=s.charCodeAt(i);return a}function BAtos(a){for(var s="",i=0;i<a.length;i++)s+=String.fromCharCode(a[i]);return s}function BAtohex(a){for(var s="",i=0;i<a.length;i++){var hex1=a[i].toString(16);1==hex1.length&&(hex1="0"+hex1),s+=hex1}return s}function stohex(s){return BAtohex(stoBA(s))}function stob64(s){return hex2b64(stohex(s))}function stob64u(s){return b64tob64u(hex2b64(stohex(s)))}function b64utos(s){return BAtos(b64toBA(b64utob64(s)))}function b64tob64u(s){return s=(s=(s=s.replace(/\=/g,"")).replace(/\+/g,"-")).replace(/\//g,"_")}function b64utob64(s){return s.length%4==2?s+="==":s.length%4==3&&(s+="="),s=(s=s.replace(/-/g,"+")).replace(/_/g,"/")}function hextob64u(s){return s.length%2==1&&(s="0"+s),b64tob64u(hex2b64(s))}function b64utohex(s){return b64tohex(b64utob64(s))}function utf8tob64(s){return hex2b64(uricmptohex(encodeURIComponentAll(s)))}function b64toutf8(s){return decodeURIComponent(hextouricmp(b64tohex(s)))}function utf8tohex(s){return uricmptohex(encodeURIComponentAll(s))}function hextoutf8(s){return decodeURIComponent(hextouricmp(s))}function hextorstr(sHex){for(var s="",i=0;i<sHex.length-1;i+=2)s+=String.fromCharCode(parseInt(sHex.substr(i,2),16));return s}function rstrtohex(s){for(var result="",i=0;i<s.length;i++)result+=("0"+s.charCodeAt(i).toString(16)).slice(-2);return result}function hextob64(s){return hex2b64(s)}function hextob64nl(s){var b64nl=hextob64(s).replace(/(.{64})/g,"$1\r\n");return b64nl=b64nl.replace(/\r\n$/,"")}function b64nltohex(s){return b64tohex(s.replace(/[^0-9A-Za-z\/+=]*/g,""))}function hextoArrayBuffer(hex){if(hex.length%2!=0)throw"input is not even length";if(null==hex.match(/^[0-9A-Fa-f]+$/))throw"input is not hexadecimal";for(var buffer=new ArrayBuffer(hex.length/2),view=new DataView(buffer),i=0;i<hex.length/2;i++)view.setUint8(i,parseInt(hex.substr(2*i,2),16));return buffer}function ArrayBuffertohex(buffer){for(var hex="",view=new DataView(buffer),i=0;i<buffer.byteLength;i++)hex+=("00"+view.getUint8(i).toString(16)).slice(-2);return hex}function uricmptohex(s){return s.replace(/%/g,"")}function hextouricmp(s){return s.replace(/(..)/g,"%$1")}function encodeURIComponentAll(u8){for(var s=encodeURIComponent(u8),s2="",i=0;i<s.length;i++)"%"==s[i]?(s2+=s.substr(i,3),i+=2):s2=s2+"%"+stohex(s[i]);return s2}function newline_toUnix(s){return s=s.replace(/\r\n/gm,"\n")}function newline_toDos(s){return s=(s=s.replace(/\r\n/gm,"\n")).replace(/\n/gm,"\r\n")}function intarystrtohex(s){s=(s=(s=s.replace(/^\s*\[\s*/,"")).replace(/\s*\]\s*$/,"")).replace(/\s*/g,"");try{return s.split(/,/).map(function(element,index,array){var i=parseInt(element);if(i<0||255<i)throw"integer not in range 0-255";return("00"+i.toString(16)).slice(-2)}).join("")}catch(ex){throw"malformed integer array string: "+ex}}ASN1HEX.getByteLengthOfL_AtObj=function(a,b){if("8"!=a.substring(b+2,b+3))return 1;var c=parseInt(a.substring(b+3,b+4));return 0==c?-1:0<c&&c<10?c+1:-2},ASN1HEX.getHexOfL_AtObj=function(a,b){var c=ASN1HEX.getByteLengthOfL_AtObj(a,b);return c<1?"":a.substring(b+2,b+2+2*c)},ASN1HEX.getIntOfL_AtObj=function(a,b){var c=ASN1HEX.getHexOfL_AtObj(a,b);return""==c?-1:(parseInt(c.substring(0,1))<8?new BigInteger(c,16):new BigInteger(c.substring(2),16)).intValue()},ASN1HEX.getStartPosOfV_AtObj=function(a,b){var c=ASN1HEX.getByteLengthOfL_AtObj(a,b);return c<0?c:b+2*(c+1)},ASN1HEX.getHexOfV_AtObj=function(a,b){var c=ASN1HEX.getStartPosOfV_AtObj(a,b),d=ASN1HEX.getIntOfL_AtObj(a,b);return a.substring(c,c+2*d)},ASN1HEX.getHexOfTLV_AtObj=function(a,b){return a.substr(b,2)+ASN1HEX.getHexOfL_AtObj(a,b)+ASN1HEX.getHexOfV_AtObj(a,b)},ASN1HEX.getPosOfNextSibling_AtObj=function(a,b){return ASN1HEX.getStartPosOfV_AtObj(a,b)+2*ASN1HEX.getIntOfL_AtObj(a,b)},ASN1HEX.getPosArrayOfChildren_AtObj=function(a,b){var c=new Array,d=ASN1HEX.getStartPosOfV_AtObj(a,b);"03"==a.substr(b,2)?c.push(d+2):c.push(d);for(var e=ASN1HEX.getIntOfL_AtObj(a,b),f=d,g=0;;){var h=ASN1HEX.getPosOfNextSibling_AtObj(a,f);if(null==h||2*e<=h-d)break;if(200<=g)break;c.push(h),f=h,g++}return c},ASN1HEX.getNthChildIndex_AtObj=function(a,b,c){return ASN1HEX.getPosArrayOfChildren_AtObj(a,b)[c]},ASN1HEX.getDecendantIndexByNthList=function(a,b,c){if(0==c.length)return b;var d=c.shift(),e=ASN1HEX.getPosArrayOfChildren_AtObj(a,b);return ASN1HEX.getDecendantIndexByNthList(a,e[d],c)},ASN1HEX.getDecendantHexTLVByNthList=function(a,b,c){var d=ASN1HEX.getDecendantIndexByNthList(a,b,c);return ASN1HEX.getHexOfTLV_AtObj(a,d)},ASN1HEX.getDecendantHexVByNthList=function(a,b,c){var d=ASN1HEX.getDecendantIndexByNthList(a,b,c);return ASN1HEX.getHexOfV_AtObj(a,d)},ASN1HEX.getVbyList=function(a,b,c,d){var e=ASN1HEX.getDecendantIndexByNthList(a,b,c);if(void 0===e)throw"can't find nthList object";if(void 0!==d&&a.substr(e,2)!=d)throw"checking tag doesn't match: "+a.substr(e,2)+"!="+d;return ASN1HEX.getHexOfV_AtObj(a,e)},ASN1HEX.hextooidstr=function(a){var b=function(a,b){return a.length>=b?a:new Array(b-a.length+1).join("0")+a},c=[],d=a.substr(0,2),e=parseInt(d,16);c[0]=new String(Math.floor(e/40)),c[1]=new String(e%40);for(var f=a.substr(2),g=[],h=0;h<f.length/2;h++)g.push(parseInt(f.substr(2*h,2),16));var i=[],j="";for(h=0;h<g.length;h++)128&g[h]?j+=b((127&g[h]).toString(2),7):(j+=b((127&g[h]).toString(2),7),i.push(new String(parseInt(j,2))),j="");var k=c.join(".");return 0<i.length&&(k=k+"."+i.join(".")),k},ASN1HEX.dump=function(a,b,c,d){var e=a;a instanceof KJUR.asn1.ASN1Object&&(e=a.getEncodedHex());var f=function(a,b){return a.length<=2*b?a:a.substr(0,b)+"..(total "+a.length/2+"bytes).."+a.substr(a.length-b,b)};void 0===b&&(b={ommit_long_octet:32}),void 0===c&&(c=0),void 0===d&&(d="");var g=b.ommit_long_octet;if("01"==e.substr(c,2))return"00"==(h=ASN1HEX.getHexOfV_AtObj(e,c))?d+"BOOLEAN FALSE\n":d+"BOOLEAN TRUE\n";if("02"==e.substr(c,2))return d+"INTEGER "+f(h=ASN1HEX.getHexOfV_AtObj(e,c),g)+"\n";if("03"==e.substr(c,2))return d+"BITSTRING "+f(h=ASN1HEX.getHexOfV_AtObj(e,c),g)+"\n";if("04"==e.substr(c,2)){var h=ASN1HEX.getHexOfV_AtObj(e,c);return ASN1HEX.isASN1HEX(h)?(i=d+"OCTETSTRING, encapsulates\n")+ASN1HEX.dump(h,b,0,d+"  "):d+"OCTETSTRING "+f(h,g)+"\n"}if("05"==e.substr(c,2))return d+"NULL\n";if("06"==e.substr(c,2)){var j=ASN1HEX.getHexOfV_AtObj(e,c),k=KJUR.asn1.ASN1Util.oidHexToInt(j),l=KJUR.asn1.x509.OID.oid2name(k),m=k.replace(/\./g," ");return""!=l?d+"ObjectIdentifier "+l+" ("+m+")\n":d+"ObjectIdentifier ("+m+")\n"}if("0c"==e.substr(c,2))return d+"UTF8String '"+hextoutf8(ASN1HEX.getHexOfV_AtObj(e,c))+"'\n";if("13"==e.substr(c,2))return d+"PrintableString '"+hextoutf8(ASN1HEX.getHexOfV_AtObj(e,c))+"'\n";if("14"==e.substr(c,2))return d+"TeletexString '"+hextoutf8(ASN1HEX.getHexOfV_AtObj(e,c))+"'\n";if("16"==e.substr(c,2))return d+"IA5String '"+hextoutf8(ASN1HEX.getHexOfV_AtObj(e,c))+"'\n";if("17"==e.substr(c,2))return d+"UTCTime "+hextoutf8(ASN1HEX.getHexOfV_AtObj(e,c))+"\n";if("18"==e.substr(c,2))return d+"GeneralizedTime "+hextoutf8(ASN1HEX.getHexOfV_AtObj(e,c))+"\n";if("30"==e.substr(c,2)){if("3000"==e.substr(c,4))return d+"SEQUENCE {}\n";var i=d+"SEQUENCE\n",o=b;if((2==(n=ASN1HEX.getPosArrayOfChildren_AtObj(e,c)).length||3==n.length)&&"06"==e.substr(n[0],2)&&"04"==e.substr(n[n.length-1],2)){var p=ASN1HEX.getHexOfV_AtObj(e,n[0]),q=(k=KJUR.asn1.ASN1Util.oidHexToInt(p),l=KJUR.asn1.x509.OID.oid2name(k),JSON.parse(JSON.stringify(b)));q.x509ExtName=l,o=q}for(var r=0;r<n.length;r++)i+=ASN1HEX.dump(e,o,n[r],d+"  ");return i}if("31"==e.substr(c,2)){i=d+"SET\n";var n=ASN1HEX.getPosArrayOfChildren_AtObj(e,c);for(r=0;r<n.length;r++)i+=ASN1HEX.dump(e,b,n[r],d+"  ");return i}var s=parseInt(e.substr(c,2),16);if(0!=(128&s)){var t=31&s;if(0!=(32&s)){var i=d+"["+t+"]\n";for(n=ASN1HEX.getPosArrayOfChildren_AtObj(e,c),r=0;r<n.length;r++)i+=ASN1HEX.dump(e,b,n[r],d+"  ");return i}return"68747470"==(h=ASN1HEX.getHexOfV_AtObj(e,c)).substr(0,8)&&(h=hextoutf8(h)),"subjectAltName"===b.x509ExtName&&2==t&&(h=hextoutf8(h)),i=d+"["+t+"] "+h+"\n"}return d+"UNKNOWN("+e.substr(c,2)+") "+ASN1HEX.getHexOfV_AtObj(e,c)+"\n"},ASN1HEX.isASN1HEX=function(a){if(a.length%2==1)return!1;var b=ASN1HEX.getIntOfL_AtObj(a,0),c=a.substr(0,2),d=ASN1HEX.getHexOfL_AtObj(a,0);return a.length-c.length-d.length==2*b},X509.pemToBase64=function(sCertPEM){var s=sCertPEM;return s=(s=(s=s.replace("-----BEGIN CERTIFICATE-----","")).replace("-----END CERTIFICATE-----","")).replace(/[ \n]+/g,"")},X509.pemToHex=function(sCertPEM){return b64tohex(X509.pemToBase64(sCertPEM))},X509.getSubjectPublicKeyPosFromCertHex=function(hCert){var pInfo=X509.getSubjectPublicKeyInfoPosFromCertHex(hCert);if(-1==pInfo)return-1;var a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pInfo);if(2!=a.length)return-1;var pBitString=a[1];if("03"!=hCert.substring(pBitString,pBitString+2))return-1;var pBitStringV=ASN1HEX.getStartPosOfV_AtObj(hCert,pBitString);return"00"!=hCert.substring(pBitStringV,pBitStringV+2)?-1:pBitStringV+2},X509.getSubjectPublicKeyInfoPosFromCertHex=function(hCert){var pTbsCert=ASN1HEX.getStartPosOfV_AtObj(hCert,0),a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pTbsCert);return a.length<1?-1:"a003020102"==hCert.substring(a[0],a[0]+10)?a.length<6?-1:a[6]:a.length<5?-1:a[5]},X509.getPublicKeyHexArrayFromCertHex=function(hCert){var p=X509.getSubjectPublicKeyPosFromCertHex(hCert),a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,p);if(2!=a.length)return[];var hN=ASN1HEX.getHexOfV_AtObj(hCert,a[0]),hE=ASN1HEX.getHexOfV_AtObj(hCert,a[1]);return null!=hN&&null!=hE?[hN,hE]:[]},X509.getHexTbsCertificateFromCert=function(hCert){return ASN1HEX.getStartPosOfV_AtObj(hCert,0)},X509.getPublicKeyHexArrayFromCertPEM=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM);return X509.getPublicKeyHexArrayFromCertHex(hCert)},X509.hex2dn=function(hex,idx){if(void 0===idx&&(idx=0),"30"!==hex.substr(idx,2))throw"malformed DN";for(var a=new Array,aIdx=ASN1HEX.getPosArrayOfChildren_AtObj(hex,idx),i=0;i<aIdx.length;i++)a.push(X509.hex2rdn(hex,aIdx[i]));return"/"+(a=a.map(function(s){return s.replace("/","\\/")})).join("/")},X509.hex2rdn=function(hex,idx){if(void 0===idx&&(idx=0),"31"!==hex.substr(idx,2))throw"malformed RDN";for(var a=new Array,aIdx=ASN1HEX.getPosArrayOfChildren_AtObj(hex,idx),i=0;i<aIdx.length;i++)a.push(X509.hex2attrTypeValue(hex,aIdx[i]));return(a=a.map(function(s){return s.replace("+","\\+")})).join("+")},X509.hex2attrTypeValue=function(hex,idx){if(void 0===idx&&(idx=0),"30"!==hex.substr(idx,2))throw"malformed attribute type and value";var aIdx=ASN1HEX.getPosArrayOfChildren_AtObj(hex,idx);2!==aIdx.length||hex.substr(aIdx[0],2);var oidHex=ASN1HEX.getHexOfV_AtObj(hex,aIdx[0]),oidInt=KJUR.asn1.ASN1Util.oidHexToInt(oidHex);return KJUR.asn1.x509.OID.oid2atype(oidInt)+"="+hextorstr(ASN1HEX.getHexOfV_AtObj(hex,aIdx[1]))},X509.getPublicKeyFromCertPEM=function(sCertPEM){var info=X509.getPublicKeyInfoPropOfCertPEM(sCertPEM);if("2a864886f70d010101"==info.algoid){var aRSA=KEYUTIL.parsePublicRawRSAKeyHex(info.keyhex);return(key=new RSAKey).setPublic(aRSA.n,aRSA.e),key}if("2a8648ce3d0201"==info.algoid){var curveName=KJUR.crypto.OID.oidhex2name[info.algparam];return(key=new KJUR.crypto.ECDSA({curve:curveName,info:info.keyhex})).setPublicKeyHex(info.keyhex),key}if("2a8648ce380401"==info.algoid){var key,p=ASN1HEX.getVbyList(info.algparam,0,[0],"02"),q=ASN1HEX.getVbyList(info.algparam,0,[1],"02"),g=ASN1HEX.getVbyList(info.algparam,0,[2],"02"),y=ASN1HEX.getHexOfV_AtObj(info.keyhex,0);return y=y.substr(2),(key=new KJUR.crypto.DSA).setPublic(new BigInteger(p,16),new BigInteger(q,16),new BigInteger(g,16),new BigInteger(y,16)),key}throw"unsupported key"},X509.getPublicKeyInfoPropOfCertPEM=function(sCertPEM){var result={algparam:null},hCert=X509.pemToHex(sCertPEM),a1=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,0);if(3!=a1.length)throw"malformed X.509 certificate PEM (code:001)";if("30"!=hCert.substr(a1[0],2))throw"malformed X.509 certificate PEM (code:002)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a1[0]),idx_spi=6;if("a0"!==hCert.substr(a2[0],2)&&(idx_spi=5),a2.length<idx_spi+1)throw"malformed X.509 certificate PEM (code:003)";var a3=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a2[idx_spi]);if(2!=a3.length)throw"malformed X.509 certificate PEM (code:004)";var a4=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a3[0]);if(2!=a4.length)throw"malformed X.509 certificate PEM (code:005)";if(result.algoid=ASN1HEX.getHexOfV_AtObj(hCert,a4[0]),"06"==hCert.substr(a4[1],2)?result.algparam=ASN1HEX.getHexOfV_AtObj(hCert,a4[1]):"30"==hCert.substr(a4[1],2)&&(result.algparam=ASN1HEX.getHexOfTLV_AtObj(hCert,a4[1])),"03"!=hCert.substr(a3[1],2))throw"malformed X.509 certificate PEM (code:006)";var unusedBitAndKeyHex=ASN1HEX.getHexOfV_AtObj(hCert,a3[1]);return result.keyhex=unusedBitAndKeyHex.substr(2),result},X509.getPublicKeyInfoPosOfCertHEX=function(hCert){var a1=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,0);if(3!=a1.length)throw"malformed X.509 certificate PEM (code:001)";if("30"!=hCert.substr(a1[0],2))throw"malformed X.509 certificate PEM (code:002)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a1[0]);if(a2.length<7)throw"malformed X.509 certificate PEM (code:003)";return a2[6]},X509.getV3ExtInfoListOfCertHex=function(hCert){var a1=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,0);if(3!=a1.length)throw"malformed X.509 certificate PEM (code:001)";if("30"!=hCert.substr(a1[0],2))throw"malformed X.509 certificate PEM (code:002)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a1[0]);if(a2.length<8)throw"malformed X.509 certificate PEM (code:003)";if("a3"!=hCert.substr(a2[7],2))throw"malformed X.509 certificate PEM (code:004)";var a3=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a2[7]);if(1!=a3.length)throw"malformed X.509 certificate PEM (code:005)";if("30"!=hCert.substr(a3[0],2))throw"malformed X.509 certificate PEM (code:006)";for(var a4=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a3[0]),numExt=a4.length,aInfo=new Array(numExt),i=0;i<numExt;i++)aInfo[i]=X509.getV3ExtItemInfo_AtObj(hCert,a4[i]);return aInfo},X509.getV3ExtItemInfo_AtObj=function(hCert,pos){var info={};info.posTLV=pos;var a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pos);if(2!=a.length&&3!=a.length)throw"malformed X.509v3 Ext (code:001)";if("06"!=hCert.substr(a[0],2))throw"malformed X.509v3 Ext (code:002)";var valueHex=ASN1HEX.getHexOfV_AtObj(hCert,a[0]);info.oid=ASN1HEX.hextooidstr(valueHex),info.critical=!1,3==a.length&&(info.critical=!0);var posExtV=a[a.length-1];if("04"!=hCert.substr(posExtV,2))throw"malformed X.509v3 Ext (code:003)";return info.posV=ASN1HEX.getStartPosOfV_AtObj(hCert,posExtV),info},X509.getHexOfTLV_V3ExtValue=function(hCert,oidOrName){var pos=X509.getPosOfTLV_V3ExtValue(hCert,oidOrName);return-1==pos?null:ASN1HEX.getHexOfTLV_AtObj(hCert,pos)},X509.getHexOfV_V3ExtValue=function(hCert,oidOrName){var pos=X509.getPosOfTLV_V3ExtValue(hCert,oidOrName);return-1==pos?null:ASN1HEX.getHexOfV_AtObj(hCert,pos)},X509.getPosOfTLV_V3ExtValue=function(hCert,oidOrName){var oid=oidOrName;if(oidOrName.match(/^[0-9.]+$/)||(oid=KJUR.asn1.x509.OID.name2oid(oidOrName)),""==oid)return-1;for(var infoList=X509.getV3ExtInfoListOfCertHex(hCert),i=0;i<infoList.length;i++){var info=infoList[i];if(info.oid==oid)return info.posV}return-1},X509.getExtBasicConstraints=function(hCert){var hBC=X509.getHexOfV_V3ExtValue(hCert,"basicConstraints");if(null===hBC)return null;if(""===hBC)return{};if("0101ff"===hBC)return{cA:!0};if("0101ff02"===hBC.substr(0,8)){var pathLexHex=ASN1HEX.getHexOfV_AtObj(hBC,6);return{cA:!0,pathLen:parseInt(pathLexHex,16)}}throw"unknown error"},X509.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"],X509.getExtKeyUsageBin=function(hCert){var hKeyUsage=X509.getHexOfV_V3ExtValue(hCert,"keyUsage");if(""==hKeyUsage)return"";if(hKeyUsage.length%2!=0||hKeyUsage.length<=2)throw"malformed key usage value";var unusedBits=parseInt(hKeyUsage.substr(0,2)),bKeyUsage=parseInt(hKeyUsage.substr(2),16).toString(2);return bKeyUsage.substr(0,bKeyUsage.length-unusedBits)},X509.getExtKeyUsageString=function(hCert){for(var bKeyUsage=X509.getExtKeyUsageBin(hCert),a=new Array,i=0;i<bKeyUsage.length;i++)"1"==bKeyUsage.substr(i,1)&&a.push(X509.KEYUSAGE_NAME[i]);return a.join(",")},X509.getExtSubjectKeyIdentifier=function(hCert){return X509.getHexOfV_V3ExtValue(hCert,"subjectKeyIdentifier")},X509.getExtAuthorityKeyIdentifier=function(hCert){var result={},hAKID=X509.getHexOfTLV_V3ExtValue(hCert,"authorityKeyIdentifier");if(null===hAKID)return null;for(var a=ASN1HEX.getPosArrayOfChildren_AtObj(hAKID,0),i=0;i<a.length;i++)"80"===hAKID.substr(a[i],2)&&(result.kid=ASN1HEX.getHexOfV_AtObj(hAKID,a[i]));return result},X509.getExtExtKeyUsageName=function(hCert){var result=new Array,h=X509.getHexOfTLV_V3ExtValue(hCert,"extKeyUsage");if(null===h)return null;for(var a=ASN1HEX.getPosArrayOfChildren_AtObj(h,0),i=0;i<a.length;i++){var hex=ASN1HEX.getHexOfV_AtObj(h,a[i]),oid=KJUR.asn1.ASN1Util.oidHexToInt(hex),name=KJUR.asn1.x509.OID.oid2name(oid);result.push(name)}return result},X509.getExtSubjectAltName=function(hCert){for(var result=new Array,h=X509.getHexOfTLV_V3ExtValue(hCert,"subjectAltName"),a=ASN1HEX.getPosArrayOfChildren_AtObj(h,0),i=0;i<a.length;i++)if("82"===h.substr(a[i],2)){var fqdn=hextoutf8(ASN1HEX.getHexOfV_AtObj(h,a[i]));result.push(fqdn)}return result},X509.getExtCRLDistributionPointsURI=function(hCert){for(var result=new Array,h=X509.getHexOfTLV_V3ExtValue(hCert,"cRLDistributionPoints"),a=ASN1HEX.getPosArrayOfChildren_AtObj(h,0),i=0;i<a.length;i++)for(var hDP=ASN1HEX.getHexOfTLV_AtObj(h,a[i]),a1=ASN1HEX.getPosArrayOfChildren_AtObj(hDP,0),j=0;j<a1.length;j++)if("a0"===hDP.substr(a1[j],2)){var hDPN=ASN1HEX.getHexOfV_AtObj(hDP,a1[j]);if("a0"===hDPN.substr(0,2)){var hFullName=ASN1HEX.getHexOfV_AtObj(hDPN,0);if("86"===hFullName.substr(0,2)){var uri=hextoutf8(ASN1HEX.getHexOfV_AtObj(hFullName,0));result.push(uri)}}}return result},X509.getExtAIAInfo=function(hCert){var result={ocsp:[],caissuer:[]},pos1=X509.getPosOfTLV_V3ExtValue(hCert,"authorityInfoAccess");if(-1==pos1)return null;if("30"!=hCert.substr(pos1,2))throw"malformed AIA Extn Value";for(var posAccDescList=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pos1),i=0;i<posAccDescList.length;i++){var p=posAccDescList[i],posAccDescChild=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,p);if(2!=posAccDescChild.length)throw"malformed AccessDescription of AIA Extn";var pOID=posAccDescChild[0],pName=posAccDescChild[1];"2b06010505073001"==ASN1HEX.getHexOfV_AtObj(hCert,pOID)&&"86"==hCert.substr(pName,2)&&result.ocsp.push(hextoutf8(ASN1HEX.getHexOfV_AtObj(hCert,pName))),"2b06010505073002"==ASN1HEX.getHexOfV_AtObj(hCert,pOID)&&"86"==hCert.substr(pName,2)&&result.caissuer.push(hextoutf8(ASN1HEX.getHexOfV_AtObj(hCert,pName)))}return result},X509.getSignatureAlgorithmName=function(hCert){var sigAlgOidHex=ASN1HEX.getDecendantHexVByNthList(hCert,0,[1,0]),sigAlgOidInt=KJUR.asn1.ASN1Util.oidHexToInt(sigAlgOidHex);return KJUR.asn1.x509.OID.oid2name(sigAlgOidInt)},X509.getSignatureValueHex=function(hCert){var h=ASN1HEX.getDecendantHexVByNthList(hCert,0,[2]);if("00"!==h.substr(0,2))throw"can't get signature value";return h.substr(2)},X509.getSerialNumberHex=function(hCert){return ASN1HEX.getDecendantHexVByNthList(hCert,0,[0,1])},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.crypto&&KJUR.crypto||(KJUR.crypto={}),KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"},this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"},this.CRYPTOJSMESSAGEDIGESTNAME={md5:CryptoJS.algo.MD5,sha1:CryptoJS.algo.SHA1,sha224:CryptoJS.algo.SHA224,sha256:CryptoJS.algo.SHA256,sha384:CryptoJS.algo.SHA384,sha512:CryptoJS.algo.SHA512,ripemd160:CryptoJS.algo.RIPEMD160},this.getDigestInfoHex=function(a,b){if(void 0===this.DIGESTINFOHEAD[b])throw"alg not supported in Util.DIGESTINFOHEAD: "+b;return this.DIGESTINFOHEAD[b]+a},this.getPaddedDigestInfoHex=function(a,b,c){var d=this.getDigestInfoHex(a,b),e=c/4;if(d.length+22>e)throw"key is too short for SigAlg: keylen="+c+","+b;for(var f="0001",g="00"+d,h="",i=e-f.length-g.length,j=0;j<i;j+=2)h+="ff";return f+h+g},this.hashString=function(a,b){return new KJUR.crypto.MessageDigest({alg:b}).digestString(a)},this.hashHex=function(a,b){return new KJUR.crypto.MessageDigest({alg:b}).digestHex(a)},this.sha1=function(a){return new KJUR.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"}).digestString(a)},this.sha256=function(a){return new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"}).digestString(a)},this.sha256Hex=function(a){return new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"}).digestHex(a)},this.sha512=function(a){return new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"}).digestString(a)},this.sha512Hex=function(a){return new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"}).digestHex(a)}},KJUR.crypto.Util.md5=function(a){return new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"}).digestString(a)},KJUR.crypto.Util.ripemd160=function(a){return new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"}).digestString(a)},KJUR.crypto.Util.SECURERANDOMGEN=new SecureRandom,KJUR.crypto.Util.getRandomHexOfNbytes=function(a){var b=new Array(a);return KJUR.crypto.Util.SECURERANDOMGEN.nextBytes(b),BAtohex(b)},KJUR.crypto.Util.getRandomBigIntegerOfNbytes=function(a){return new BigInteger(KJUR.crypto.Util.getRandomHexOfNbytes(a),16)},KJUR.crypto.Util.getRandomHexOfNbits=function(a){var b=a%8,d=new Array((a-b)/8+1);return KJUR.crypto.Util.SECURERANDOMGEN.nextBytes(d),d[0]=(255<<b&255^255)&d[0],BAtohex(d)},KJUR.crypto.Util.getRandomBigIntegerOfNbits=function(a){return new BigInteger(KJUR.crypto.Util.getRandomHexOfNbits(a),16)},KJUR.crypto.Util.getRandomBigIntegerZeroToMax=function(a){for(var b=a.bitLength();;){var c=KJUR.crypto.Util.getRandomBigIntegerOfNbits(b);if(-1!=a.compareTo(c))return c}},KJUR.crypto.Util.getRandomBigIntegerMinToMax=function(a,b){var c=a.compareTo(b);if(1==c)throw"biMin is greater than biMax";if(0==c)return a;var d=b.subtract(a);return KJUR.crypto.Util.getRandomBigIntegerZeroToMax(d).add(a)},KJUR.crypto.MessageDigest=function(a){this.setAlgAndProvider=function(a,b){if(null!==(a=KJUR.crypto.MessageDigest.getCanonicalAlgName(a))&&void 0===b&&(b=KJUR.crypto.Util.DEFAULTPROVIDER[a]),-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(a)&&"cryptojs"==b){try{this.md=KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[a].create()}catch(b){throw"setAlgAndProvider hash alg set fail alg="+a+"/"+b}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var b=CryptoJS.enc.Hex.parse(a);this.md.update(b)},this.digest=function(){return this.md.finalize().toString(CryptoJS.enc.Hex)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}if(-1!=":sha256:".indexOf(a)&&"sjcl"==b){try{this.md=new sjcl.hash.sha256}catch(b){throw"setAlgAndProvider hash alg set fail alg="+a+"/"+b}this.updateString=function(a){this.md.update(a)},this.updateHex=function(a){var b=sjcl.codec.hex.toBits(a);this.md.update(b)},this.digest=function(){var a=this.md.finalize();return sjcl.codec.hex.fromBits(a)},this.digestString=function(a){return this.updateString(a),this.digest()},this.digestHex=function(a){return this.updateHex(a),this.digest()}}},this.updateString=function(a){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestString=function(a){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName},this.digestHex=function(a){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName},void 0!==a&&void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName))},KJUR.crypto.MessageDigest.getCanonicalAlgName=function(a){return"string"==typeof a&&(a=(a=a.toLowerCase()).replace(/-/,"")),a},KJUR.crypto.MessageDigest.getHashLength=function(a){var b=KJUR.crypto.MessageDigest,c=b.getCanonicalAlgName(a);if(void 0===b.HASHLENGTH[c])throw"not supported algorithm: "+a;return b.HASHLENGTH[c]},KJUR.crypto.MessageDigest.HASHLENGTH={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,ripemd160:20},KJUR.crypto.Mac=function(a){this.setAlgAndProvider=function(a,b){if(null==(a=a.toLowerCase())&&(a="hmacsha1"),"hmac"!=(a=a.toLowerCase()).substr(0,4))throw"setAlgAndProvider unsupported HMAC alg: "+a;void 0===b&&(b=KJUR.crypto.Util.DEFAULTPROVIDER[a]),this.algProv=a+"/"+b;var c=a.substr(4);if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(c)&&"cryptojs"==b){try{var d=KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[c];this.mac=CryptoJS.algo.HMAC.create(d,this.pass)}catch(a){throw"setAlgAndProvider hash alg set fail hashAlg="+c+"/"+a}this.updateString=function(a){this.mac.update(a)},this.updateHex=function(a){var b=CryptoJS.enc.Hex.parse(a);this.mac.update(b)},this.doFinal=function(){return this.mac.finalize().toString(CryptoJS.enc.Hex)},this.doFinalString=function(a){return this.updateString(a),this.doFinal()},this.doFinalHex=function(a){return this.updateHex(a),this.doFinal()}}},this.updateString=function(a){throw"updateString(str) not supported for this alg/prov: "+this.algProv},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv},this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv},this.doFinalString=function(a){throw"digestString(str) not supported for this alg/prov: "+this.algProv},this.doFinalHex=function(a){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv},this.setPassword=function(a){if("string"==typeof a){var b=a;return a.length%2!=1&&a.match(/^[0-9A-Fa-f]+$/)||(b=rstrtohex(a)),void(this.pass=CryptoJS.enc.Hex.parse(b))}if("object"!=typeof a)throw"KJUR.crypto.Mac unsupported password type: "+a;b=null;if(void 0!==a.hex){if(a.hex.length%2!=0||!a.hex.match(/^[0-9A-Fa-f]+$/))throw"Mac: wrong hex password: "+a.hex;b=a.hex}if(void 0!==a.utf8&&(b=utf8tohex(a.utf8)),void 0!==a.rstr&&(b=rstrtohex(a.rstr)),void 0!==a.b64&&(b=b64tohex(a.b64)),void 0!==a.b64u&&(b=b64utohex(a.b64u)),null==b)throw"KJUR.crypto.Mac unsupported password type: "+a;this.pass=CryptoJS.enc.Hex.parse(b)},void 0!==a&&(void 0!==a.pass&&this.setPassword(a.pass),void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov&&(this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]),this.setAlgAndProvider(this.algName,this.provName)))},KJUR.crypto.Signature=function(a){var b=null;if(this._setAlgNames=function(){var a=this.algName.match(/^(.+)with(.+)$/);a&&(this.mdAlgName=a[1].toLowerCase(),this.pubkeyAlgName=a[2].toLowerCase())},this._zeroPaddingOfSignature=function(a,b){for(var c="",d=b/4-a.length,e=0;e<d;e++)c+="0";return c+a},this.setAlgAndProvider=function(a,b){if(this._setAlgNames(),"cryptojs/jsrsa"!=b)throw"provider not supported: "+b;if(-1!=":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(a){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+a}this.init=function(a,b){var c=null;try{c=void 0===b?KEYUTIL.getKey(a):KEYUTIL.getKey(a,b)}catch(a){throw"init failed:"+a}if(!0===c.isPrivate)this.prvKey=c,this.state="SIGN";else{if(!0!==c.isPublic)throw"init failed.:"+c;this.pubKey=c,this.state="VERIFY"}},this.initSign=function(a){"string"==typeof a.ecprvhex&&"string"==typeof a.eccurvename?(this.ecprvhex=a.ecprvhex,this.eccurvename=a.eccurvename):this.prvKey=a,this.state="SIGN"},this.initVerifyByPublicKey=function(a){"string"==typeof a.ecpubhex&&"string"==typeof a.eccurvename?(this.ecpubhex=a.ecpubhex,this.eccurvename=a.eccurvename):a instanceof KJUR.crypto.ECDSA?this.pubKey=a:a instanceof RSAKey&&(this.pubKey=a),this.state="VERIFY"},this.initVerifyByCertificatePEM=function(a){var b=new X509;b.readCertPEM(a),this.pubKey=b.subjectPublicKeyRSA,this.state="VERIFY"},this.updateString=function(a){this.md.updateString(a)},this.updateHex=function(a){this.md.updateHex(a)},this.sign=function(){if(this.sHashHex=this.md.digest(),void 0!==this.ecprvhex&&void 0!==this.eccurvename){var a=new KJUR.crypto.ECDSA({curve:this.eccurvename});this.hSign=a.signHex(this.sHashHex,this.ecprvhex)}else if(this.prvKey instanceof RSAKey&&"rsaandmgf1"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen);else if(this.prvKey instanceof RSAKey&&"rsa"==this.pubkeyAlgName)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName);else if(this.prvKey instanceof KJUR.crypto.ECDSA)this.hSign=this.prvKey.signWithMessageHash(this.sHashHex);else{if(!(this.prvKey instanceof KJUR.crypto.DSA))throw"Signature: unsupported public key alg: "+this.pubkeyAlgName;this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}return this.hSign},this.signString=function(a){return this.updateString(a),this.sign()},this.signHex=function(a){return this.updateHex(a),this.sign()},this.verify=function(a){if(this.sHashHex=this.md.digest(),void 0!==this.ecpubhex&&void 0!==this.eccurvename)return new KJUR.crypto.ECDSA({curve:this.eccurvename}).verifyHex(this.sHashHex,a,this.ecpubhex);if(this.pubKey instanceof RSAKey&&"rsaandmgf1"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,a,this.mdAlgName,this.pssSaltLen);if(this.pubKey instanceof RSAKey&&"rsa"==this.pubkeyAlgName)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);if(this.pubKey instanceof KJUR.crypto.ECDSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);if(this.pubKey instanceof KJUR.crypto.DSA)return this.pubKey.verifyWithMessageHash(this.sHashHex,a);throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}},this.init=function(a,b){throw"init(key, pass) not supported for this alg:prov="+this.algProvName},this.initVerifyByPublicKey=function(a){throw"initVerifyByPublicKey(rsaPubKeyy) not supported for this alg:prov="+this.algProvName},this.initVerifyByCertificatePEM=function(a){throw"initVerifyByCertificatePEM(certPEM) not supported for this alg:prov="+this.algProvName},this.initSign=function(a){throw"initSign(prvKey) not supported for this alg:prov="+this.algProvName},this.updateString=function(a){throw"updateString(str) not supported for this alg:prov="+this.algProvName},this.updateHex=function(a){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName},this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName},this.signString=function(a){throw"digestString(str) not supported for this alg:prov="+this.algProvName},this.signHex=function(a){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName},this.verify=function(a){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName},void 0!==(this.initParams=a)&&(void 0!==a.alg&&(this.algName=a.alg,void 0===a.prov?this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]:this.provName=a.prov,this.algProvName=this.algName+":"+this.provName,this.setAlgAndProvider(this.algName,this.provName),this._setAlgNames()),void 0!==a.psssaltlen&&(this.pssSaltLen=a.psssaltlen),void 0!==a.prvkeypem)){if(void 0!==a.prvkeypas)throw"both prvkeypem and prvkeypas parameters not supported";try{(b=new RSAKey).readPrivateKeyFromPEMString(a.prvkeypem),this.initSign(b)}catch(a){throw"fatal error to load pem private key: "+a}}},KJUR.crypto.Cipher=function(a){},KJUR.crypto.Cipher.encrypt=function(a,b,c){if(b instanceof RSAKey&&b.isPublic){var d=KJUR.crypto.Cipher.getAlgByKeyAndName(b,c);if("RSA"===d)return b.encrypt(a);if("RSAOAEP"===d)return b.encryptOAEP(a,"sha1");var e=d.match(/^RSAOAEP(\d+)$/);if(null!==e)return b.encryptOAEP(a,"sha"+e[1]);throw"Cipher.encrypt: unsupported algorithm for RSAKey: "+c}throw"Cipher.encrypt: unsupported key or algorithm"},KJUR.crypto.Cipher.decrypt=function(a,b,c){if(b instanceof RSAKey&&b.isPrivate){var d=KJUR.crypto.Cipher.getAlgByKeyAndName(b,c);if("RSA"===d)return b.decrypt(a);if("RSAOAEP"===d)return b.decryptOAEP(a,"sha1");var e=d.match(/^RSAOAEP(\d+)$/);if(null!==e)return b.decryptOAEP(a,"sha"+e[1]);throw"Cipher.decrypt: unsupported algorithm for RSAKey: "+c}throw"Cipher.decrypt: unsupported key or algorithm"},KJUR.crypto.Cipher.getAlgByKeyAndName=function(a,b){if(a instanceof RSAKey){if(-1!=":RSA:RSAOAEP:RSAOAEP224:RSAOAEP256:RSAOAEP384:RSAOAEP512:".indexOf(b))return b;if(null==b)return"RSA";throw"getAlgByKeyAndName: not supported algorithm name for RSAKey: "+b}throw"getAlgByKeyAndName: not supported algorithm name: "+b},KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}},void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.lang&&KJUR.lang||(KJUR.lang={}),KJUR.lang.String=function(){},"function"==typeof Buffer?(utf8tob64u=function(s){return b64tob64u(new Buffer(s,"utf8").toString("base64"))},b64utoutf8=function(s){return new Buffer(b64utob64(s),"base64").toString("utf8")}):(utf8tob64u=function(s){return hextob64u(uricmptohex(encodeURIComponentAll(s)))},b64utoutf8=function(s){return decodeURIComponent(hextouricmp(b64utohex(s)))}),KJUR.lang.String.isInteger=function(s){return!!s.match(/^[0-9]+$/)||!!s.match(/^-[0-9]+$/)},KJUR.lang.String.isHex=function(s){return!(s.length%2!=0||!s.match(/^[0-9a-f]+$/)&&!s.match(/^[0-9A-F]+$/))},KJUR.lang.String.isBase64=function(s){return!(!(s=s.replace(/\s+/g,"")).match(/^[0-9A-Za-z+\/]+={0,3}$/)||s.length%4!=0)},KJUR.lang.String.isBase64URL=function(s){return!s.match(/[+/=]/)&&(s=b64utob64(s),KJUR.lang.String.isBase64(s))},KJUR.lang.String.isIntegerArray=function(s){return!!(s=s.replace(/\s+/g,"")).match(/^\[[0-9,]+\]$/)};var strdiffidx=function(s1,s2){var n=s1.length;s1.length>s2.length&&(n=s2.length);for(var i=0;i<n;i++)if(s1.charCodeAt(i)!=s2.charCodeAt(i))return i;return s1.length!=s2.length?n:-1};function Arcfour(){this.i=0,this.j=0,this.S=new Array}function ARC4init(d){var c,a,b;for(c=0;c<256;++c)this.S[c]=c;for(c=a=0;c<256;++c)a=a+this.S[c]+d[c%d.length]&255,b=this.S[c],this.S[c]=this.S[a],this.S[a]=b;this.i=0,this.j=0}function ARC4next(){var a;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,a=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=a,this.S[a+this.S[this.i]&255]}function prng_newstate(){return new Arcfour}Arcfour.prototype.init=ARC4init,Arcfour.prototype.next=ARC4next;var rng_state,rng_pool,rng_pptr,rng_psize=256;function rng_seed_int(a){rng_pool[rng_pptr++]^=255&a,rng_pool[rng_pptr++]^=a>>8&255,rng_pool[rng_pptr++]^=a>>16&255,rng_pool[rng_pptr++]^=a>>24&255,rng_psize<=rng_pptr&&(rng_pptr-=rng_psize)}function rng_seed_time(){rng_seed_int((new Date).getTime())}if(null==rng_pool){var t;if(rng_pool=new Array,rng_pptr=0,"Netscape"==navigator.appName&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t)rng_pool[rng_pptr++]=255&z.charCodeAt(t)}for(;rng_pptr<rng_psize;)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=t>>>8,rng_pool[rng_pptr++]=255&t;rng_pptr=0,rng_seed_time()}function rng_get_byte(){if(null==rng_state){for(rng_seed_time(),(rng_state=prng_newstate()).init(rng_pool),rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(b){var a;for(a=0;a<b.length;++a)b[a]=rng_get_byte()}function SecureRandom(){}SecureRandom.prototype.nextBytes=rng_get_bytes;var jsonParse=function(){var d=new RegExp('(?:false|true|null|[\\{\\}\\[\\]]|(?:-?\\b(?:0|[1-9][0-9]*)(?:\\.[0-9]+)?(?:[eE][+-]?[0-9]+)?\\b)|(?:"(?:[^\\0-\\x08\\x0a-\\x1f"\\\\]|\\\\(?:["/\\\\bfnrt]|u[0-9A-Fa-f]{4}))*"))',"g"),k=new RegExp("\\\\(?:([^u])|u(.{4}))","g"),g={'"':'"',"/":"/","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"};function h(l,m,n){return m?g[m]:String.fromCharCode(parseInt(n,16))}var c=new String(""),b=(Object,Array,Object.hasOwnProperty);return function(u,q){var x,t,p=u.match(d),v=p[0],l=!1;"{"===v?x={}:"["===v?x=[]:(x=[],l=!0);for(var r=[x],o=1-l,m=p.length;o<m;++o){var w;switch((v=p[o]).charCodeAt(0)){default:(w=r[0])[t||w.length]=+v,t=void 0;break;case 34:if(-1!==(v=v.substring(1,v.length-1)).indexOf("\\")&&(v=v.replace(k,h)),w=r[0],!t){if(!(w instanceof Array)){t=v||c;break}t=w.length}w[t]=v,t=void 0;break;case 91:w=r[0],r.unshift(w[t||w.length]=[]),t=void 0;break;case 93:r.shift();break;case 102:(w=r[0])[t||w.length]=!1,t=void 0;break;case 110:(w=r[0])[t||w.length]=null,t=void 0;break;case 116:(w=r[0])[t||w.length]=!0,t=void 0;break;case 123:w=r[0],r.unshift(w[t||w.length]={}),t=void 0;break;case 125:r.shift()}}if(l){if(1!==r.length)throw new Error;x=x[0]}else if(r.length)throw new Error;if(q){var s=function(C,B){var D=C[B];if(D&&"object"==typeof D){var n=null;for(var z in D)if(b.call(D,z)&&D!==C){var y=s(D,z);void 0!==y?D[z]=y:(n||(n=[]),n.push(z))}if(n)for(var A=n.length;0<=--A;)delete D[n[A]]}return q.call(C,B,D)};x=s({"":x},"")}return x}}();void 0!==KJUR&&KJUR||(KJUR={}),void 0!==KJUR.jws&&KJUR.jws||(KJUR.jws={}),KJUR.jws.JWS=function(){var a=KJUR.jws.JWS;this.parseJWS=function(b,c){if(void 0===this.parsedJWS||!c&&void 0===this.parsedJWS.sigvalH){var d=b.match(/^([^.]+)\.([^.]+)\.([^.]+)$/);if(null==d)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";var e=d[1],f=d[2],g=d[3],h=e+"."+f;if(this.parsedJWS={},this.parsedJWS.headB64U=e,this.parsedJWS.payloadB64U=f,this.parsedJWS.sigvalB64U=g,this.parsedJWS.si=h,!c){var i=b64utohex(g),j=parseBigInt(i,16);this.parsedJWS.sigvalH=i,this.parsedJWS.sigvalBI=j}var k=b64utoutf8(e),l=b64utoutf8(f);if(this.parsedJWS.headS=k,this.parsedJWS.payloadS=l,!a.isSafeJSONString(k,this.parsedJWS,"headP"))throw"malformed JSON string for JWS Head: "+k}}},KJUR.jws.JWS.sign=function(a,b,c,d,e){var g,h,i,f=KJUR.jws.JWS;if("string"!=typeof b&&"object"!=typeof b)throw"spHeader must be JSON string or object: "+b;if("object"==typeof b&&(h=b,g=JSON.stringify(h)),"string"==typeof b){if(g=b,!f.isSafeJSONString(g))throw"JWS Head is not safe JSON string: "+g;h=f.readSafeJSONString(g)}if("object"==typeof(i=c)&&(i=JSON.stringify(c)),""!=a&&null!=a||void 0===h.alg||(a=h.alg),""!=a&&null!=a&&void 0===h.alg&&(h.alg=a,g=JSON.stringify(h)),a!==h.alg)throw"alg and sHeader.alg doesn't match: "+a+"!="+h.alg;var j=null;if(void 0===f.jwsalg2sigalg[a])throw"unsupported alg name: "+a;j=f.jwsalg2sigalg[a];var m=utf8tob64u(g)+"."+utf8tob64u(i),n="";if("Hmac"==j.substr(0,4)){if(void 0===d)throw"mac key shall be specified for HS* alg";var o=new KJUR.crypto.Mac({alg:j,prov:"cryptojs",pass:d});o.updateString(m),n=o.doFinal()}else if(-1!=j.indexOf("withECDSA")){(p=new KJUR.crypto.Signature({alg:j})).init(d,e),p.updateString(m),hASN1Sig=p.sign(),n=KJUR.crypto.ECDSA.asn1SigToConcatSig(hASN1Sig)}else if("none"!=j){var p;(p=new KJUR.crypto.Signature({alg:j})).init(d,e),p.updateString(m),n=p.sign()}return m+"."+hextob64u(n)},KJUR.jws.JWS.verify=function(a,b,c){var l,d=KJUR.jws.JWS,e=a.split("."),h=e[0]+"."+e[1],i=b64utohex(e[2]),j=d.readSafeJSONString(b64utoutf8(e[0])),k=null;if(void 0===j.alg)throw"algorithm not specified in header";if((l=(k=j.alg).substr(0,2),null!=c&&"[object Array]"===Object.prototype.toString.call(c)&&0<c.length)&&-1==(":"+c.join(":")+":").indexOf(":"+k+":"))throw"algorithm '"+k+"' not accepted in the list";if("none"!=k&&null===b)throw"key shall be specified to verify.";if("string"==typeof b&&-1!=b.indexOf("-----BEGIN ")&&(b=KEYUTIL.getKey(b)),!("RS"!=l&&"PS"!=l||b instanceof RSAKey))throw"key shall be a RSAKey obj for RS* and PS* algs";if("ES"==l&&!(b instanceof KJUR.crypto.ECDSA))throw"key shall be a ECDSA obj for ES* algs";var n=null;if(void 0===d.jwsalg2sigalg[j.alg])throw"unsupported alg name: "+k;if("none"==(n=d.jwsalg2sigalg[k]))throw"not supported";if("Hmac"==n.substr(0,4)){if(void 0===b)throw"hexadecimal key shall be specified for HMAC";var p=new KJUR.crypto.Mac({alg:n,pass:b});return p.updateString(h),i==p.doFinal()}if(-1!=n.indexOf("withECDSA")){var r,q=null;try{q=KJUR.crypto.ECDSA.concatSigToASN1Sig(i)}catch(a){return!1}return(r=new KJUR.crypto.Signature({alg:n})).init(b),r.updateString(h),r.verify(q)}return(r=new KJUR.crypto.Signature({alg:n})).init(b),r.updateString(h),r.verify(i)},KJUR.jws.JWS.parse=function(a){var d,e,f,b=a.split("."),c={};if(2!=b.length&&3!=b.length)throw"malformed sJWS: wrong number of '.' splitted elements";return d=b[0],e=b[1],3==b.length&&(f=b[2]),c.headerObj=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(d)),c.payloadObj=KJUR.jws.JWS.readSafeJSONString(b64utoutf8(e)),c.headerPP=JSON.stringify(c.headerObj,null,"  "),null==c.payloadObj?c.payloadPP=b64utoutf8(e):c.payloadPP=JSON.stringify(c.payloadObj,null,"  "),void 0!==f&&(c.sigHex=b64utohex(f)),c},KJUR.jws.JWS.verifyJWT=function(a,b,c){var d=KJUR.jws.JWS,e=a.split("."),f=e[0],g=e[1],j=(b64utohex(e[2]),d.readSafeJSONString(b64utoutf8(f))),k=d.readSafeJSONString(b64utoutf8(g));if(void 0===j.alg)return!1;if(void 0===c.alg)throw"acceptField.alg shall be specified";if(!d.inArray(j.alg,c.alg))return!1;if(void 0!==k.iss&&"object"==typeof c.iss&&!d.inArray(k.iss,c.iss))return!1;if(void 0!==k.sub&&"object"==typeof c.sub&&!d.inArray(k.sub,c.sub))return!1;if(void 0!==k.aud&&"object"==typeof c.aud)if("string"==typeof k.aud){if(!d.inArray(k.aud,c.aud))return!1}else if("object"==typeof k.aud&&!d.includedArray(k.aud,c.aud))return!1;var l=KJUR.jws.IntDate.getNow();return void 0!==c.verifyAt&&"number"==typeof c.verifyAt&&(l=c.verifyAt),void 0!==c.gracePeriod&&"number"==typeof c.gracePeriod||(c.gracePeriod=0),!(void 0!==k.exp&&"number"==typeof k.exp&&k.exp+c.gracePeriod<l||void 0!==k.nbf&&"number"==typeof k.nbf&&l<k.nbf-c.gracePeriod||void 0!==k.iat&&"number"==typeof k.iat&&l<k.iat-c.gracePeriod||void 0!==k.jti&&void 0!==c.jti&&k.jti!==c.jti||!KJUR.jws.JWS.verify(a,b,c.alg))},KJUR.jws.JWS.includedArray=function(a,b){var c=KJUR.jws.JWS.inArray;if(null===a)return!1;if("object"!=typeof a)return!1;if("number"!=typeof a.length)return!1;for(var d=0;d<a.length;d++)if(!c(a[d],b))return!1;return!0},KJUR.jws.JWS.inArray=function(a,b){if(null===b)return!1;if("object"!=typeof b)return!1;if("number"!=typeof b.length)return!1;for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1},KJUR.jws.JWS.jwsalg2sigalg={HS256:"HmacSHA256",HS384:"HmacSHA384",HS512:"HmacSHA512",RS256:"SHA256withRSA",RS384:"SHA384withRSA",RS512:"SHA512withRSA",ES256:"SHA256withECDSA",ES384:"SHA384withECDSA",PS256:"SHA256withRSAandMGF1",PS384:"SHA384withRSAandMGF1",PS512:"SHA512withRSAandMGF1",none:"none"},KJUR.jws.JWS.isSafeJSONString=function(a,b,c){var d=null;try{return"object"!=typeof(d=jsonParse(a))?0:d.constructor===Array?0:(b&&(b[c]=d),1)}catch(a){return 0}},KJUR.jws.JWS.readSafeJSONString=function(a){var b=null;try{return"object"!=typeof(b=jsonParse(a))?null:b.constructor===Array?null:b}catch(a){return null}},KJUR.jws.JWS.getEncodedSignatureValueFromJWS=function(a){var b=a.match(/^[^.]+\.[^.]+\.([^.]+)$/);if(null==b)throw"JWS signature is not a form of 'Head.Payload.SigValue'.";return b[1]},KJUR.jws.JWS.getJWKthumbprint=function(a){if("RSA"!==a.kty&&"EC"!==a.kty&&"oct"!==a.kty)throw"unsupported algorithm for JWK Thumprint";var b="{";if("RSA"===a.kty){if("string"!=typeof a.n||"string"!=typeof a.e)throw"wrong n and e value for RSA key";b+='"e":"'+a.e+'",',b+='"kty":"'+a.kty+'",',b+='"n":"'+a.n+'"}'}else if("EC"===a.kty){if("string"!=typeof a.crv||"string"!=typeof a.x||"string"!=typeof a.y)throw"wrong crv, x and y value for EC key";b+='"crv":"'+a.crv+'",',b+='"kty":"'+a.kty+'",',b+='"x":"'+a.x+'",',b+='"y":"'+a.y+'"}'}else if("oct"===a.kty){if("string"!=typeof a.k)throw"wrong k value for oct(symmetric) key";b+='"kty":"'+a.kty+'",',b+='"k":"'+a.k+'"}'}var c=rstrtohex(b);return hextob64u(KJUR.crypto.Util.hashHex(c,"sha256"))},KJUR.jws.IntDate={},KJUR.jws.IntDate.get=function(a){if("now"==a)return KJUR.jws.IntDate.getNow();if("now + 1hour"==a)return KJUR.jws.IntDate.getNow()+3600;if("now + 1day"==a)return KJUR.jws.IntDate.getNow()+86400;if("now + 1month"==a)return KJUR.jws.IntDate.getNow()+2592e3;if("now + 1year"==a)return KJUR.jws.IntDate.getNow()+31536e3;if(a.match(/Z$/))return KJUR.jws.IntDate.getZulu(a);if(a.match(/^[0-9]+$/))return parseInt(a);throw"unsupported format: "+a},KJUR.jws.IntDate.getZulu=function(a){var b=a.match(/(\d+)(\d\d)(\d\d)(\d\d)(\d\d)(\d\d)Z/);if(b){var c=b[1],d=parseInt(c);if(4==c.length);else{if(2!=c.length)throw"malformed year string";if(50<=d&&d<100)d=1900+d;else{if(!(0<=d&&d<50))throw"malformed year string for UTCTime";d=2e3+d}}var e=parseInt(b[2])-1,f=parseInt(b[3]),g=parseInt(b[4]),h=parseInt(b[5]),i=parseInt(b[6]);return~~(new Date(Date.UTC(d,e,f,g,h,i))/1e3)}throw"unsupported format: "+a},KJUR.jws.IntDate.getNow=function(){return~~(new Date/1e3)},KJUR.jws.IntDate.intDate2UTCString=function(a){return new Date(1e3*a).toUTCString()},KJUR.jws.IntDate.intDate2Zulu=function(a){var b=new Date(1e3*a);return("0000"+b.getUTCFullYear()).slice(-4)+("00"+(b.getUTCMonth()+1)).slice(-2)+("00"+b.getUTCDate()).slice(-2)+("00"+b.getUTCHours()).slice(-2)+("00"+b.getUTCMinutes()).slice(-2)+("00"+b.getUTCSeconds()).slice(-2)+"Z"};var KEYUTIL=function(){var a=function(a,b,c){return d(CryptoJS.AES,a,b,c)},d=function(a,b,c,d){var e=CryptoJS.enc.Hex.parse(b),f=CryptoJS.enc.Hex.parse(c),g=CryptoJS.enc.Hex.parse(d),h={};h.key=f,h.iv=g,h.ciphertext=e;var i=a.decrypt(h,f,{iv:g});return CryptoJS.enc.Hex.stringify(i)},e=function(a,b,c){return h(CryptoJS.AES,a,b,c)},h=function(a,b,c,d){var e=CryptoJS.enc.Hex.parse(b),f=CryptoJS.enc.Hex.parse(c),g=CryptoJS.enc.Hex.parse(d),h=a.encrypt(e,f,{iv:g}),i=CryptoJS.enc.Hex.parse(h.toString());return CryptoJS.enc.Base64.stringify(i)},i={"AES-256-CBC":{proc:a,eproc:e,keylen:32,ivlen:16},"AES-192-CBC":{proc:a,eproc:e,keylen:24,ivlen:16},"AES-128-CBC":{proc:a,eproc:e,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:function(a,b,c){return d(CryptoJS.TripleDES,a,b,c)},eproc:function(a,b,c){return h(CryptoJS.TripleDES,a,b,c)},keylen:24,ivlen:8},"DES-CBC":{proc:function(a,b,c){return d(CryptoJS.DES,a,b,c)},eproc:function(a,b,c){return h(CryptoJS.DES,a,b,c)},keylen:8,ivlen:8}},l=function(a){var b={},c=a.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"));c&&(b.cipher=c[1],b.ivsalt=c[2]);var d=a.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"));d&&(b.type=d[1]);var e=-1,f=0;-1!=a.indexOf("\r\n\r\n")&&(e=a.indexOf("\r\n\r\n"),f=2),-1!=a.indexOf("\n\n")&&(e=a.indexOf("\n\n"),f=1);var g=a.indexOf("-----END");if(-1!=e&&-1!=g){var h=a.substring(e+2*f,g-f);h=h.replace(/\s+/g,""),b.data=h}return b},m=function(a,b,c){for(var d=c.substring(0,16),e=CryptoJS.enc.Hex.parse(d),f=CryptoJS.enc.Utf8.parse(b),g=i[a].keylen+i[a].ivlen,h="",j=null;;){var k=CryptoJS.algo.MD5.create();if(null!=j&&k.update(j),k.update(f),k.update(e),j=k.finalize(),(h+=CryptoJS.enc.Hex.stringify(j)).length>=2*g)break}var l={};return l.keyhex=h.substr(0,2*i[a].keylen),l.ivhex=h.substr(2*i[a].keylen,2*i[a].ivlen),l},n=function(a,b,c,d){var e=CryptoJS.enc.Base64.parse(a),f=CryptoJS.enc.Hex.stringify(e);return(0,i[b].proc)(f,c,d)};return{version:"1.0.0",getHexFromPEM:function(a,b){var c=a;if(-1==c.indexOf("-----BEGIN "))throw"can't find PEM header: "+b;return"string"==typeof b&&""!=b?c=(c=c.replace("-----BEGIN "+b+"-----","")).replace("-----END "+b+"-----",""):c=(c=c.replace(/-----BEGIN [^-]+-----/,"")).replace(/-----END [^-]+-----/,""),b64tohex(c.replace(/\s+/g,""))},getDecryptedKeyHexByKeyIV:function(a,b,c,d){return function(a){return i[a].proc}(b)(a,c,d)},parsePKCS5PEM:function(a){return l(a)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(a,b,c){return m(a,b,c)},decryptKeyB64:function(a,b,c,d){return n(a,b,c,d)},getDecryptedKeyHex:function(a,b){var c=l(a),e=(c.type,c.cipher),f=c.ivsalt,g=c.data,i=m(e,b,f).keyhex;return n(g,e,i,f)},getRSAKeyFromEncryptedPKCS5PEM:function(a,b){var c=this.getDecryptedKeyHex(a,b),d=new RSAKey;return d.readPrivateKeyFromASN1HexString(c),d},getEncryptedPKCS5PEMFromPrvKeyHex:function(a,b,c,d,e){var f="";if(void 0!==d&&null!=d||(d="AES-256-CBC"),void 0===i[d])throw"KEYUTIL unsupported algorithm: "+d;void 0!==e&&null!=e||(e=function(a){var b=CryptoJS.lib.WordArray.random(a);return CryptoJS.enc.Hex.stringify(b)}(i[d].ivlen).toUpperCase());f="-----BEGIN "+a+" PRIVATE KEY-----\r\n";return f+="Proc-Type: 4,ENCRYPTED\r\n",f+="DEK-Info: "+d+","+e+"\r\n",f+="\r\n",(f+=function(a,b,c,d){return(0,i[b].eproc)(a,c,d)}(b,d,m(d,c,e).keyhex,e).replace(/(.{64})/g,"$1\r\n"))+"\r\n-----END "+a+" PRIVATE KEY-----\r\n"},getEncryptedPKCS5PEMFromRSAKey:function(a,b,c,d){var e=new KJUR.asn1.DERInteger({int:0}),f=new KJUR.asn1.DERInteger({bigint:a.n}),g=new KJUR.asn1.DERInteger({int:a.e}),h=new KJUR.asn1.DERInteger({bigint:a.d}),i=new KJUR.asn1.DERInteger({bigint:a.p}),j=new KJUR.asn1.DERInteger({bigint:a.q}),k=new KJUR.asn1.DERInteger({bigint:a.dmp1}),l=new KJUR.asn1.DERInteger({bigint:a.dmq1}),m=new KJUR.asn1.DERInteger({bigint:a.coeff}),o=new KJUR.asn1.DERSequence({array:[e,f,g,h,i,j,k,l,m]}).getEncodedHex();return this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",o,b,c,d)},newEncryptedPKCS5PEM:function(a,b,c,d){void 0!==b&&null!=b||(b=1024),void 0!==c&&null!=c||(c="10001");var e=new RSAKey;e.generate(b,c);return void 0===d||null==d?this.getEncryptedPKCS5PEMFromRSAKey(e,a):this.getEncryptedPKCS5PEMFromRSAKey(e,a,d)},getRSAKeyFromPlainPKCS8PEM:function(a){if(a.match(/ENCRYPTED/))throw"pem shall be not ENCRYPTED";var b=this.getHexFromPEM(a,"PRIVATE KEY");return this.getRSAKeyFromPlainPKCS8Hex(b)},getRSAKeyFromPlainPKCS8Hex:function(a){var b=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(3!=b.length)throw"outer DERSequence shall have 3 elements: "+b.length;if("300d06092a864886f70d0101010500"!=(c=ASN1HEX.getHexOfTLV_AtObj(a,b[1])))throw"PKCS8 AlgorithmIdentifier is not rsaEnc: "+c;var c=ASN1HEX.getHexOfTLV_AtObj(a,b[1]),d=ASN1HEX.getHexOfTLV_AtObj(a,b[2]),e=ASN1HEX.getHexOfV_AtObj(d,0),f=new RSAKey;return f.readPrivateKeyFromASN1HexString(e),f},parseHexOfEncryptedPKCS8:function(a){var b={},c=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(2!=c.length)throw"malformed format: SEQUENCE(0).items != 2: "+c.length;b.ciphertext=ASN1HEX.getHexOfV_AtObj(a,c[1]);var d=ASN1HEX.getPosArrayOfChildren_AtObj(a,c[0]);if(2!=d.length)throw"malformed format: SEQUENCE(0.0).items != 2: "+d.length;if("2a864886f70d01050d"!=ASN1HEX.getHexOfV_AtObj(a,d[0]))throw"this only supports pkcs5PBES2";var e=ASN1HEX.getPosArrayOfChildren_AtObj(a,d[1]);if(2!=d.length)throw"malformed format: SEQUENCE(0.0.1).items != 2: "+e.length;var f=ASN1HEX.getPosArrayOfChildren_AtObj(a,e[1]);if(2!=f.length)throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+f.length;if("2a864886f70d0307"!=ASN1HEX.getHexOfV_AtObj(a,f[0]))throw"this only supports TripleDES";b.encryptionSchemeAlg="TripleDES",b.encryptionSchemeIV=ASN1HEX.getHexOfV_AtObj(a,f[1]);var g=ASN1HEX.getPosArrayOfChildren_AtObj(a,e[0]);if(2!=g.length)throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+g.length;if("2a864886f70d01050c"!=ASN1HEX.getHexOfV_AtObj(a,g[0]))throw"this only supports pkcs5PBKDF2";var h=ASN1HEX.getPosArrayOfChildren_AtObj(a,g[1]);if(h.length<2)throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+h.length;b.pbkdf2Salt=ASN1HEX.getHexOfV_AtObj(a,h[0]);var i=ASN1HEX.getHexOfV_AtObj(a,h[1]);try{b.pbkdf2Iter=parseInt(i,16)}catch(a){throw"malformed format pbkdf2Iter: "+i}return b},getPBKDF2KeyHexFromParam:function(a,b){var c=CryptoJS.enc.Hex.parse(a.pbkdf2Salt),d=a.pbkdf2Iter,e=CryptoJS.PBKDF2(b,c,{keySize:6,iterations:d});return CryptoJS.enc.Hex.stringify(e)},getPlainPKCS8HexFromEncryptedPKCS8PEM:function(a,b){var c=this.getHexFromPEM(a,"ENCRYPTED PRIVATE KEY"),d=this.parseHexOfEncryptedPKCS8(c),e=KEYUTIL.getPBKDF2KeyHexFromParam(d,b),f={};f.ciphertext=CryptoJS.enc.Hex.parse(d.ciphertext);var g=CryptoJS.enc.Hex.parse(e),h=CryptoJS.enc.Hex.parse(d.encryptionSchemeIV),i=CryptoJS.TripleDES.decrypt(f,g,{iv:h});return CryptoJS.enc.Hex.stringify(i)},getRSAKeyFromEncryptedPKCS8PEM:function(a,b){var c=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(a,b);return this.getRSAKeyFromPlainPKCS8Hex(c)},getKeyFromEncryptedPKCS8PEM:function(a,b){var c=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(a,b);return this.getKeyFromPlainPrivatePKCS8Hex(c)},parsePlainPrivatePKCS8Hex:function(a){var b={algparam:null};if("30"!=a.substr(0,2))throw"malformed plain PKCS8 private key(code:001)";var c=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(3!=c.length)throw"malformed plain PKCS8 private key(code:002)";if("30"!=a.substr(c[1],2))throw"malformed PKCS8 private key(code:003)";var d=ASN1HEX.getPosArrayOfChildren_AtObj(a,c[1]);if(2!=d.length)throw"malformed PKCS8 private key(code:004)";if("06"!=a.substr(d[0],2))throw"malformed PKCS8 private key(code:005)";if(b.algoid=ASN1HEX.getHexOfV_AtObj(a,d[0]),"06"==a.substr(d[1],2)&&(b.algparam=ASN1HEX.getHexOfV_AtObj(a,d[1])),"04"!=a.substr(c[2],2))throw"malformed PKCS8 private key(code:006)";return b.keyidx=ASN1HEX.getStartPosOfV_AtObj(a,c[2]),b},getKeyFromPlainPrivatePKCS8PEM:function(a){var b=this.getHexFromPEM(a,"PRIVATE KEY");return this.getKeyFromPlainPrivatePKCS8Hex(b)},getKeyFromPlainPrivatePKCS8Hex:function(a){var b=this.parsePlainPrivatePKCS8Hex(a);if("2a864886f70d010101"==b.algoid){this.parsePrivateRawRSAKeyHexAtObj(a,b);var c=b.key;return(d=new RSAKey).setPrivateEx(c.n,c.e,c.d,c.p,c.q,c.dp,c.dq,c.co),d}if("2a8648ce3d0201"==b.algoid){if(this.parsePrivateRawECKeyHexAtObj(a,b),void 0===KJUR.crypto.OID.oidhex2name[b.algparam])throw"KJUR.crypto.OID.oidhex2name undefined: "+b.algparam;var e=KJUR.crypto.OID.oidhex2name[b.algparam];return(d=new KJUR.crypto.ECDSA({curve:e})).setPublicKeyHex(b.pubkey),d.setPrivateKeyHex(b.key),d.isPublic=!1,d}if("2a8648ce380401"==b.algoid){var d,f=ASN1HEX.getVbyList(a,0,[1,1,0],"02"),g=ASN1HEX.getVbyList(a,0,[1,1,1],"02"),h=ASN1HEX.getVbyList(a,0,[1,1,2],"02"),i=ASN1HEX.getVbyList(a,0,[2,0],"02"),j=new BigInteger(f,16),k=new BigInteger(g,16),l=new BigInteger(h,16),m=new BigInteger(i,16);return(d=new KJUR.crypto.DSA).setPrivate(j,k,l,null,m),d}throw"unsupported private key algorithm"},getRSAKeyFromPublicPKCS8PEM:function(a){var b=this.getHexFromPEM(a,"PUBLIC KEY");return this.getRSAKeyFromPublicPKCS8Hex(b)},getKeyFromPublicPKCS8PEM:function(a){var b=this.getHexFromPEM(a,"PUBLIC KEY");return this.getKeyFromPublicPKCS8Hex(b)},getKeyFromPublicPKCS8Hex:function(a){var b=this.parsePublicPKCS8Hex(a);if("2a864886f70d010101"==b.algoid){var c=this.parsePublicRawRSAKeyHex(b.key);return(d=new RSAKey).setPublic(c.n,c.e),d}if("2a8648ce3d0201"==b.algoid){if(void 0===KJUR.crypto.OID.oidhex2name[b.algparam])throw"KJUR.crypto.OID.oidhex2name undefined: "+b.algparam;var e=KJUR.crypto.OID.oidhex2name[b.algparam];return d=new KJUR.crypto.ECDSA({curve:e,pub:b.key})}if("2a8648ce380401"==b.algoid){var d,f=b.algparam,g=ASN1HEX.getHexOfV_AtObj(b.key,0);return(d=new KJUR.crypto.DSA).setPublic(new BigInteger(f.p,16),new BigInteger(f.q,16),new BigInteger(f.g,16),new BigInteger(g,16)),d}throw"unsupported public key algorithm"},parsePublicRawRSAKeyHex:function(a){var b={};if("30"!=a.substr(0,2))throw"malformed RSA key(code:001)";var c=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(2!=c.length)throw"malformed RSA key(code:002)";if("02"!=a.substr(c[0],2))throw"malformed RSA key(code:003)";if(b.n=ASN1HEX.getHexOfV_AtObj(a,c[0]),"02"!=a.substr(c[1],2))throw"malformed RSA key(code:004)";return b.e=ASN1HEX.getHexOfV_AtObj(a,c[1]),b},parsePrivateRawRSAKeyHexAtObj:function(a,b){var c=b.keyidx;if("30"!=a.substr(c,2))throw"malformed RSA private key(code:001)";var d=ASN1HEX.getPosArrayOfChildren_AtObj(a,c);if(9!=d.length)throw"malformed RSA private key(code:002)";b.key={},b.key.n=ASN1HEX.getHexOfV_AtObj(a,d[1]),b.key.e=ASN1HEX.getHexOfV_AtObj(a,d[2]),b.key.d=ASN1HEX.getHexOfV_AtObj(a,d[3]),b.key.p=ASN1HEX.getHexOfV_AtObj(a,d[4]),b.key.q=ASN1HEX.getHexOfV_AtObj(a,d[5]),b.key.dp=ASN1HEX.getHexOfV_AtObj(a,d[6]),b.key.dq=ASN1HEX.getHexOfV_AtObj(a,d[7]),b.key.co=ASN1HEX.getHexOfV_AtObj(a,d[8])},parsePrivateRawECKeyHexAtObj:function(a,b){var c=b.keyidx,d=ASN1HEX.getVbyList(a,c,[1],"04"),e=ASN1HEX.getVbyList(a,c,[2,0],"03").substr(2);b.key=d,b.pubkey=e},parsePublicPKCS8Hex:function(a){var b={algparam:null},c=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(2!=c.length)throw"outer DERSequence shall have 2 elements: "+c.length;var d=c[0];if("30"!=a.substr(d,2))throw"malformed PKCS8 public key(code:001)";var e=ASN1HEX.getPosArrayOfChildren_AtObj(a,d);if(2!=e.length)throw"malformed PKCS8 public key(code:002)";if("06"!=a.substr(e[0],2))throw"malformed PKCS8 public key(code:003)";if(b.algoid=ASN1HEX.getHexOfV_AtObj(a,e[0]),"06"==a.substr(e[1],2)?b.algparam=ASN1HEX.getHexOfV_AtObj(a,e[1]):"30"==a.substr(e[1],2)&&(b.algparam={},b.algparam.p=ASN1HEX.getVbyList(a,e[1],[0],"02"),b.algparam.q=ASN1HEX.getVbyList(a,e[1],[1],"02"),b.algparam.g=ASN1HEX.getVbyList(a,e[1],[2],"02")),"03"!=a.substr(c[1],2))throw"malformed PKCS8 public key(code:004)";return b.key=ASN1HEX.getHexOfV_AtObj(a,c[1]).substr(2),b},getRSAKeyFromPublicPKCS8Hex:function(a){var b=ASN1HEX.getPosArrayOfChildren_AtObj(a,0);if(2!=b.length)throw"outer DERSequence shall have 2 elements: "+b.length;if("300d06092a864886f70d0101010500"!=ASN1HEX.getHexOfTLV_AtObj(a,b[0]))throw"PKCS8 AlgorithmId is not rsaEncryption";if("03"!=a.substr(b[1],2))throw"PKCS8 Public Key is not BITSTRING encapslated.";var d=ASN1HEX.getStartPosOfV_AtObj(a,b[1])+2;if("30"!=a.substr(d,2))throw"PKCS8 Public Key is not SEQUENCE.";var e=ASN1HEX.getPosArrayOfChildren_AtObj(a,d);if(2!=e.length)throw"inner DERSequence shall have 2 elements: "+e.length;if("02"!=a.substr(e[0],2))throw"N is not ASN.1 INTEGER";if("02"!=a.substr(e[1],2))throw"E is not ASN.1 INTEGER";var f=ASN1HEX.getHexOfV_AtObj(a,e[0]),g=ASN1HEX.getHexOfV_AtObj(a,e[1]),h=new RSAKey;return h.setPublic(f,g),h}}}();KEYUTIL.getKey=function(a,b,c){if(void 0!==RSAKey&&a instanceof RSAKey)return a;if(void 0!==KJUR.crypto.ECDSA&&a instanceof KJUR.crypto.ECDSA)return a;if(void 0!==KJUR.crypto.DSA&&a instanceof KJUR.crypto.DSA)return a;if(void 0!==a.curve&&void 0!==a.xy&&void 0===a.d)return new KJUR.crypto.ECDSA({pub:a.xy,curve:a.curve});if(void 0!==a.curve&&void 0!==a.d)return new KJUR.crypto.ECDSA({prv:a.d,curve:a.curve});if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0===a.d)return(d=new RSAKey).setPublic(a.n,a.e),d;if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0!==a.p&&void 0!==a.q&&void 0!==a.dp&&void 0!==a.dq&&void 0!==a.co&&void 0===a.qi)return(d=new RSAKey).setPrivateEx(a.n,a.e,a.d,a.p,a.q,a.dp,a.dq,a.co),d;if(void 0===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0===a.p)return(d=new RSAKey).setPrivate(a.n,a.e,a.d),d;if(void 0!==a.p&&void 0!==a.q&&void 0!==a.g&&void 0!==a.y&&void 0===a.x)return(d=new KJUR.crypto.DSA).setPublic(a.p,a.q,a.g,a.y),d;if(void 0!==a.p&&void 0!==a.q&&void 0!==a.g&&void 0!==a.y&&void 0!==a.x)return(d=new KJUR.crypto.DSA).setPrivate(a.p,a.q,a.g,a.y,a.x),d;if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0===a.d)return(d=new RSAKey).setPublic(b64utohex(a.n),b64utohex(a.e)),d;if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d&&void 0!==a.p&&void 0!==a.q&&void 0!==a.dp&&void 0!==a.dq&&void 0!==a.qi)return(d=new RSAKey).setPrivateEx(b64utohex(a.n),b64utohex(a.e),b64utohex(a.d),b64utohex(a.p),b64utohex(a.q),b64utohex(a.dp),b64utohex(a.dq),b64utohex(a.qi)),d;if("RSA"===a.kty&&void 0!==a.n&&void 0!==a.e&&void 0!==a.d)return(d=new RSAKey).setPrivate(b64utohex(a.n),b64utohex(a.e),b64utohex(a.d)),d;if("EC"===a.kty&&void 0!==a.crv&&void 0!==a.x&&void 0!==a.y&&void 0===a.d){var f=(e=new KJUR.crypto.ECDSA({curve:a.crv})).ecparams.keylen/4,i="04"+("0000000000"+b64utohex(a.x)).slice(-f)+("0000000000"+b64utohex(a.y)).slice(-f);return e.setPublicKeyHex(i),e}if("EC"===a.kty&&void 0!==a.crv&&void 0!==a.x&&void 0!==a.y&&void 0!==a.d){f=(e=new KJUR.crypto.ECDSA({curve:a.crv})).ecparams.keylen/4,i="04"+("0000000000"+b64utohex(a.x)).slice(-f)+("0000000000"+b64utohex(a.y)).slice(-f);var j=("0000000000"+b64utohex(a.d)).slice(-f);return e.setPublicKeyHex(i),e.setPrivateKeyHex(j),e}if(-1!=a.indexOf("-END CERTIFICATE-",0)||-1!=a.indexOf("-END X509 CERTIFICATE-",0)||-1!=a.indexOf("-END TRUSTED CERTIFICATE-",0))return X509.getPublicKeyFromCertPEM(a);if("pkcs8pub"===c)return KEYUTIL.getKeyFromPublicPKCS8Hex(a);if(-1!=a.indexOf("-END PUBLIC KEY-"))return KEYUTIL.getKeyFromPublicPKCS8PEM(a);if("pkcs5prv"===c)return(d=new RSAKey).readPrivateKeyFromASN1HexString(a),d;if("pkcs5prv"===c)return(d=new RSAKey).readPrivateKeyFromASN1HexString(a),d;if(-1!=a.indexOf("-END RSA PRIVATE KEY-")&&-1==a.indexOf("4,ENCRYPTED")){var k=KEYUTIL.getHexFromPEM(a,"RSA PRIVATE KEY");return KEYUTIL.getKey(k,null,"pkcs5prv")}if(-1!=a.indexOf("-END DSA PRIVATE KEY-")&&-1==a.indexOf("4,ENCRYPTED")){var l=this.getHexFromPEM(a,"DSA PRIVATE KEY"),m=ASN1HEX.getVbyList(l,0,[1],"02"),n=ASN1HEX.getVbyList(l,0,[2],"02"),o=ASN1HEX.getVbyList(l,0,[3],"02"),p=ASN1HEX.getVbyList(l,0,[4],"02"),q=ASN1HEX.getVbyList(l,0,[5],"02");return(d=new KJUR.crypto.DSA).setPrivate(new BigInteger(m,16),new BigInteger(n,16),new BigInteger(o,16),new BigInteger(p,16),new BigInteger(q,16)),d}if(-1!=a.indexOf("-END PRIVATE KEY-"))return KEYUTIL.getKeyFromPlainPrivatePKCS8PEM(a);if(-1!=a.indexOf("-END RSA PRIVATE KEY-")&&-1!=a.indexOf("4,ENCRYPTED"))return KEYUTIL.getRSAKeyFromEncryptedPKCS5PEM(a,b);if(-1!=a.indexOf("-END EC PRIVATE KEY-")&&-1!=a.indexOf("4,ENCRYPTED")){l=KEYUTIL.getDecryptedKeyHex(a,b);var t,e,d=ASN1HEX.getVbyList(l,0,[1],"04"),r=ASN1HEX.getVbyList(l,0,[2,0],"06"),s=ASN1HEX.getVbyList(l,0,[3,0],"03").substr(2);if(void 0===KJUR.crypto.OID.oidhex2name[r])throw"undefined OID(hex) in KJUR.crypto.OID: "+r;return t=KJUR.crypto.OID.oidhex2name[r],(e=new KJUR.crypto.ECDSA({name:t})).setPublicKeyHex(s),e.setPrivateKeyHex(d),e.isPublic=!1,e}if(-1!=a.indexOf("-END DSA PRIVATE KEY-")&&-1!=a.indexOf("4,ENCRYPTED")){l=KEYUTIL.getDecryptedKeyHex(a,b),m=ASN1HEX.getVbyList(l,0,[1],"02"),n=ASN1HEX.getVbyList(l,0,[2],"02"),o=ASN1HEX.getVbyList(l,0,[3],"02"),p=ASN1HEX.getVbyList(l,0,[4],"02"),q=ASN1HEX.getVbyList(l,0,[5],"02");return(d=new KJUR.crypto.DSA).setPrivate(new BigInteger(m,16),new BigInteger(n,16),new BigInteger(o,16),new BigInteger(p,16),new BigInteger(q,16)),d}if(-1!=a.indexOf("-END ENCRYPTED PRIVATE KEY-"))return KEYUTIL.getKeyFromEncryptedPKCS8PEM(a,b);throw"not supported argument"},KEYUTIL.generateKeypair=function(a,b){if("RSA"==a){var c=b;(d=new RSAKey).generate(c,"10001"),d.isPrivate=!0,d.isPublic=!0;var e=new RSAKey,f=d.n.toString(16),g=d.e.toString(16);return e.setPublic(f,g),e.isPrivate=!1,e.isPublic=!0,(h={}).prvKeyObj=d,h.pubKeyObj=e,h}if("EC"==a){var d,h,i=b,k=new KJUR.crypto.ECDSA({curve:i}).generateKeyPairHex();return(d=new KJUR.crypto.ECDSA({curve:i})).setPublicKeyHex(k.ecpubhex),d.setPrivateKeyHex(k.ecprvhex),d.isPrivate=!0,d.isPublic=!1,(e=new KJUR.crypto.ECDSA({curve:i})).setPublicKeyHex(k.ecpubhex),e.isPrivate=!1,e.isPublic=!0,(h={}).prvKeyObj=d,h.pubKeyObj=e,h}throw"unknown algorithm: "+a},KEYUTIL.getPEM=function(a,b,c,d,e){function h(a){return KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{int:{bigint:a.n}},{int:a.e},{int:{bigint:a.d}},{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.dmp1}},{int:{bigint:a.dmq1}},{int:{bigint:a.coeff}}]})}function i(a){return KJUR.asn1.ASN1Util.newObject({seq:[{int:1},{octstr:{hex:a.prvKeyHex}},{tag:["a0",!0,{oid:{name:a.curveName}}]},{tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]}]})}function j(a){return KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.g}},{int:{bigint:a.y}},{int:{bigint:a.x}}]})}var f=KJUR.asn1,g=KJUR.crypto;if((void 0!==RSAKey&&a instanceof RSAKey||void 0!==g.DSA&&a instanceof g.DSA||void 0!==g.ECDSA&&a instanceof g.ECDSA)&&1==a.isPublic&&(void 0===b||"PKCS8PUB"==b)){var l=new KJUR.asn1.x509.SubjectPublicKeyInfo(a).getEncodedHex();return f.ASN1Util.getPEMStringFromHex(l,"PUBLIC KEY")}if("PKCS1PRV"==b&&void 0!==RSAKey&&a instanceof RSAKey&&(void 0===c||null==c)&&1==a.isPrivate){l=h(a).getEncodedHex();return f.ASN1Util.getPEMStringFromHex(l,"RSA PRIVATE KEY")}if("PKCS1PRV"==b&&void 0!==RSAKey&&a instanceof KJUR.crypto.ECDSA&&(void 0===c||null==c)&&1==a.isPrivate){var n=new KJUR.asn1.DERObjectIdentifier({name:a.curveName}).getEncodedHex(),p=i(a).getEncodedHex(),q="";return(q+=f.ASN1Util.getPEMStringFromHex(n,"EC PARAMETERS"))+f.ASN1Util.getPEMStringFromHex(p,"EC PRIVATE KEY")}if("PKCS1PRV"==b&&void 0!==KJUR.crypto.DSA&&a instanceof KJUR.crypto.DSA&&(void 0===c||null==c)&&1==a.isPrivate){l=j(a).getEncodedHex();return f.ASN1Util.getPEMStringFromHex(l,"DSA PRIVATE KEY")}if("PKCS5PRV"==b&&void 0!==RSAKey&&a instanceof RSAKey&&void 0!==c&&null!=c&&1==a.isPrivate){l=h(a).getEncodedHex();return void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",l,c,d)}if("PKCS5PRV"==b&&void 0!==KJUR.crypto.ECDSA&&a instanceof KJUR.crypto.ECDSA&&void 0!==c&&null!=c&&1==a.isPrivate){l=i(a).getEncodedHex();return void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",l,c,d)}if("PKCS5PRV"==b&&void 0!==KJUR.crypto.DSA&&a instanceof KJUR.crypto.DSA&&void 0!==c&&null!=c&&1==a.isPrivate){l=j(a).getEncodedHex();return void 0===d&&(d="DES-EDE3-CBC"),this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",l,c,d)}var r=function(a,b){var c=s(a,b);return new KJUR.asn1.ASN1Util.newObject({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:c.pbkdf2Salt}},{int:c.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:c.encryptionSchemeIV}}]}]}]},{octstr:{hex:c.ciphertext}}]}).getEncodedHex()},s=function(a,b){var d=CryptoJS.lib.WordArray.random(8),f=CryptoJS.lib.WordArray.random(8),g=CryptoJS.PBKDF2(b,d,{keySize:6,iterations:100}),h=CryptoJS.enc.Hex.parse(a),i=CryptoJS.TripleDES.encrypt(h,g,{iv:f})+"",j={};return j.ciphertext=i,j.pbkdf2Salt=CryptoJS.enc.Hex.stringify(d),j.pbkdf2Iter=100,j.encryptionSchemeAlg="DES-EDE3-CBC",j.encryptionSchemeIV=CryptoJS.enc.Hex.stringify(f),j};if("PKCS8PRV"==b&&void 0!==RSAKey&&a instanceof RSAKey&&1==a.isPrivate){var u=h(a).getEncodedHex();l=KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{seq:[{oid:{name:"rsaEncryption"}},{null:!0}]},{octstr:{hex:u}}]}).getEncodedHex();if(void 0===c||null==c)return f.ASN1Util.getPEMStringFromHex(l,"PRIVATE KEY");p=r(l,c);return f.ASN1Util.getPEMStringFromHex(p,"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==b&&void 0!==KJUR.crypto.ECDSA&&a instanceof KJUR.crypto.ECDSA&&1==a.isPrivate){u=new KJUR.asn1.ASN1Util.newObject({seq:[{int:1},{octstr:{hex:a.prvKeyHex}},{tag:["a1",!0,{bitstr:{hex:"00"+a.pubKeyHex}}]}]}).getEncodedHex(),l=KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:a.curveName}}]},{octstr:{hex:u}}]}).getEncodedHex();if(void 0===c||null==c)return f.ASN1Util.getPEMStringFromHex(l,"PRIVATE KEY");p=r(l,c);return f.ASN1Util.getPEMStringFromHex(p,"ENCRYPTED PRIVATE KEY")}if("PKCS8PRV"==b&&void 0!==KJUR.crypto.DSA&&a instanceof KJUR.crypto.DSA&&1==a.isPrivate){u=new KJUR.asn1.DERInteger({bigint:a.x}).getEncodedHex(),l=KJUR.asn1.ASN1Util.newObject({seq:[{int:0},{seq:[{oid:{name:"dsa"}},{seq:[{int:{bigint:a.p}},{int:{bigint:a.q}},{int:{bigint:a.g}}]}]},{octstr:{hex:u}}]}).getEncodedHex();if(void 0===c||null==c)return f.ASN1Util.getPEMStringFromHex(l,"PRIVATE KEY");p=r(l,c);return f.ASN1Util.getPEMStringFromHex(p,"ENCRYPTED PRIVATE KEY")}throw"unsupported object nor format"},KEYUTIL.getKeyFromCSRPEM=function(a){var b=KEYUTIL.getHexFromPEM(a,"CERTIFICATE REQUEST");return KEYUTIL.getKeyFromCSRHex(b)},KEYUTIL.getKeyFromCSRHex=function(a){var b=KEYUTIL.parseCSRHex(a);return KEYUTIL.getKey(b.p8pubkeyhex,null,"pkcs8pub")},KEYUTIL.parseCSRHex=function(a){var b={},c=a;if("30"!=c.substr(0,2))throw"malformed CSR(code:001)";var d=ASN1HEX.getPosArrayOfChildren_AtObj(c,0);if(d.length<1)throw"malformed CSR(code:002)";if("30"!=c.substr(d[0],2))throw"malformed CSR(code:003)";var e=ASN1HEX.getPosArrayOfChildren_AtObj(c,d[0]);if(e.length<3)throw"malformed CSR(code:004)";return b.p8pubkeyhex=ASN1HEX.getHexOfTLV_AtObj(c,e[2]),b},KEYUTIL.getJWKFromKey=function(a){var b={};if(a instanceof RSAKey&&a.isPrivate)return b.kty="RSA",b.n=hextob64u(a.n.toString(16)),b.e=hextob64u(a.e.toString(16)),b.d=hextob64u(a.d.toString(16)),b.p=hextob64u(a.p.toString(16)),b.q=hextob64u(a.q.toString(16)),b.dp=hextob64u(a.dmp1.toString(16)),b.dq=hextob64u(a.dmq1.toString(16)),b.qi=hextob64u(a.coeff.toString(16)),b;if(a instanceof RSAKey&&a.isPublic)return b.kty="RSA",b.n=hextob64u(a.n.toString(16)),b.e=hextob64u(a.e.toString(16)),b;if(a instanceof KJUR.crypto.ECDSA&&a.isPrivate){if("P-256"!==(c=a.getShortNISTPCurveName())&&"P-384"!==c)throw"unsupported curve name for JWT: "+c;var d=a.getPublicKeyXYHex();return b.kty="EC",b.crv=c,b.x=hextob64u(d.x),b.y=hextob64u(d.y),b.d=hextob64u(a.prvKeyHex),b}if(a instanceof KJUR.crypto.ECDSA&&a.isPublic){var c;if("P-256"!==(c=a.getShortNISTPCurveName())&&"P-384"!==c)throw"unsupported curve name for JWT: "+c;d=a.getPublicKeyXYHex();return b.kty="EC",b.crv=c,b.x=hextob64u(d.x),b.y=hextob64u(d.y),b}throw"not supported key object"};